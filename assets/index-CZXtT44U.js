import{r as ie,a as mr,g as wr,b as br,c as Er}from"./react-DA5kr_r5.js";import{u as Ht,a as vr,R as Rr,b as Cr,L as qe,B as Sr}from"./react-router-yAH5irVp.js";import"./socket.io-DgcwqWsT.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const h of c)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(c){const h={};return c.integrity&&(h.integrity=c.integrity),c.referrerPolicy&&(h.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?h.credentials="include":c.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(c){if(c.ep)return;c.ep=!0;const h=n(c);fetch(c.href,h)}})();var Gt={exports:{}},Ge={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xr=ie,Tr=Symbol.for("react.element"),Ar=Symbol.for("react.fragment"),Nr=Object.prototype.hasOwnProperty,Br=xr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ir={key:!0,ref:!0,__self:!0,__source:!0};function Yt(i,e,n){var s,c={},h=null,d=null;n!==void 0&&(h=""+n),e.key!==void 0&&(h=""+e.key),e.ref!==void 0&&(d=e.ref);for(s in e)Nr.call(e,s)&&!Ir.hasOwnProperty(s)&&(c[s]=e[s]);if(i&&i.defaultProps)for(s in e=i.defaultProps,e)c[s]===void 0&&(c[s]=e[s]);return{$$typeof:Tr,type:i,key:h,ref:d,props:c,_owner:Br.current}}Ge.Fragment=Ar;Ge.jsx=Yt;Ge.jsxs=Yt;Gt.exports=Ge;var C=Gt.exports,ht={},vt=mr;ht.createRoot=vt.createRoot,ht.hydrateRoot=vt.hydrateRoot;const Fr="_container_1myg8_25",De={container:Fr};class Or{constructor(){this.baseUrl=window.location.hostname==="localhost"?"http://localhost:3001":"https://github-pages-coonfig-test.vercel.app",this.headers={"Content-Type":"application/json","x-vercel-protection-bypass":"ODjj85wkLvMNdHMyTmekRQjzuLoPNBFw"}}async request(e,n="GET",s=null){try{const c=await fetch(`${this.baseUrl}${e}`,{method:n,headers:this.headers,body:s?JSON.stringify(s):null,mode:"cors",credentials:"include"});if(!c.ok){const d=await c.json().catch(()=>({}));throw new Error(d.message||`HTTP error! status: ${c.status}`)}return await c.json()}catch(c){throw console.error(`API Error (${n} ${e}):`,c),c}}async createRoom(e){try{return await this.request("/api/rooms/create","POST",{playerName:e})}catch(n){return console.error("Ошибка при создании комнаты:",n),null}}async joinRoom(e,n){try{return await this.request("/api/rooms/join","POST",{roomCode:e,playerName:n})}catch(s){return console.error("Ошибка при присоединении к комнате:",s),null}}async startGame(e){try{return await this.request("/api/games/start","POST",{roomCode:e})}catch(n){return console.error("Ошибка при начале игры:",n),null}}async getPlayers(e){try{return await this.request(`/api/rooms/${e}/players`)}catch(n){return console.error("Ошибка при получении списка игроков:",n),null}}async setCharacter(e,n,s){try{return await this.request("/api/players/character","POST",{roomCode:e,targetPlayerId:n,character:s})}catch(c){return console.error("Ошибка при установке персонажа:",c),null}}async leaveRoom(e){try{return await this.request(`/api/rooms/${e}/leave`,"POST")}catch(n){return console.error("Ошибка при выходе из комнаты:",n),null}}async getRoomState(e){try{return await this.request(`/api/rooms/${e}/state`)}catch(n){return console.error("Ошибка при получении состояния комнаты:",n),null}}async updatePlayerState(e,n){try{return await this.request(`/api/rooms/${e}/player-state`,"POST",n)}catch(s){return console.error("Ошибка при обновлении состояния игрока:",s),null}}startPolling(e,n,s=2e3){this._pollingInterval&&clearInterval(this._pollingInterval),this._pollingInterval=setInterval(async()=>{try{const c=await this.getRoomState(e);c&&typeof n=="function"?n(c):c||(console.warn("Получен пустой ответ от сервера"),n({players:[],gameStarted:!1}))}catch(c){console.error("Ошибка при получении обновлений комнаты:",c),typeof n=="function"&&n({players:[],gameStarted:!1})}},s)}stopPolling(){this._pollingInterval&&(clearInterval(this._pollingInterval),this._pollingInterval=null)}}const Y=new Or,Lr=()=>{const[i,e]=ie.useState(""),[n,s]=ie.useState(""),[c,h]=ie.useState(""),[d,f]=ie.useState(!1),R=Ht(),E=async()=>{if(!i.trim()){h("Введите ваше имя");return}f(!0),h("");try{const y=await Y.createRoom(i);y&&y.roomCode?(localStorage.setItem("roomCode",y.roomCode),R(`/game?name=${encodeURIComponent(i)}&room=${encodeURIComponent(y.roomCode)}&host=true`)):h("Не удалось создать комнату")}catch(y){h(y.message||"Произошла ошибка при создании комнаты")}finally{f(!1)}},b=async()=>{if(!i.trim()){h("Введите ваше имя");return}if(!n.trim()){h("Введите код комнаты");return}f(!0),h("");try{const y=await Y.joinRoom(n,i);y&&y.success?(localStorage.setItem("roomCode",n),R(`/game?name=${encodeURIComponent(i)}&room=${encodeURIComponent(n)}`)):h((y==null?void 0:y.error)||"Не удалось присоединиться к комнате")}catch(y){h(y.message||"Произошла ошибка при присоединении к комнате")}finally{f(!1)}};return C.jsxs("div",{className:De.container,children:[C.jsx("h1",{children:"Добро пожаловать в игру"}),C.jsxs("div",{className:De.form,children:[C.jsx("input",{type:"text",placeholder:"Ваше имя",value:i,onChange:y=>e(y.target.value),disabled:d}),C.jsx("input",{type:"text",placeholder:"Код комнаты (для присоединения)",value:n,onChange:y=>s(y.target.value),disabled:d}),C.jsxs("div",{className:De.buttons,children:[C.jsx("button",{onClick:E,disabled:d,children:"Создать комнату"}),C.jsx("button",{onClick:b,disabled:d,children:"Присоединиться"})]}),c&&C.jsx("p",{className:De.error,children:c}),d&&C.jsx("p",{className:De.loading,children:"Загрузка..."})]})]})},jr="_gamePage_1izas_1",kr="_gameContainer_1izas_23",Pr="_header_1izas_37",Mr="_title_1izas_49",Dr="_gameControls_1izas_61",Ur="_playerInfo_1izas_77",qr="_startButton_1izas_87",$r="_copyButton_1izas_87",Wr="_backButton_1izas_155",Vr="_errorActions_1izas_185",zr="_homeButton_1izas_199",Hr="_errorMessage_1izas_231",Gr="_retryButton_1izas_263",Yr="_loadingMessage_1izas_297",Kr="_spinnerContainer_1izas_329",Jr="_spinner_1izas_329",Xr="_spin_1izas_329",Qr="_lobbyInfo_1izas_365",Zr="_gameArea_1izas_389",en="_gameContent_1izas_401",tn="_gameDescription_1izas_411",rn="_videoGrid_1izas_425",nn="_videoBox_1izas_439",on="_playerVideoContainer_1izas_459",sn="_videoWrapper_1izas_473",an="_playerVideo_1izas_459",ln="_placeholderVideo_1izas_509",cn="_placeholderContent_1izas_531",un="_noVideoText_1izas_561",fn="_userIcon_1izas_573",hn="_playerName_1izas_595",dn="_playerCharacter_1izas_609",pn="_mediaControls_1izas_621",gn="_mutedIcon_1izas_633",_n="_videoDisabled_1izas_649",yn="_noVideoIcon_1izas_675",mn="_localVideo_1izas_687",wn="_videoControls_1izas_697",bn="_videoOn_1izas_713",En="_videoOff_1izas_713",vn="_audioOn_1izas_713",Rn="_audioOff_1izas_713",Cn="_noPlayersMessage_1izas_797",Sn="_mediaButton_1izas_843",xn="_mediaButtonActive_1izas_869",Tn="_mediaButtonDisabled_1izas_879",An="_cameraOffOverlay_1izas_897",Nn="_cameraOffIcon_1izas_923",Bn="_lobby_1izas_365",In="_streamError_1izas_961",Fn="_streamErrorIcon_1izas_993",On="_streamErrorText_1izas_1001",Ln="_altButton_1izas_1011",jn="_videoPlaceholder_1izas_1041",kn="_errorModal_1izas_1103",Pn="_errorContent_1izas_1129",Mn="_continueButton_1izas_1181",Dn="_formButtons_1izas_1211",Un="_assignButton_1izas_1277",qn="_characterForm_1izas_1309",$n="_videoStatus_1izas_1339",Wn="_videoStatusConnecting_1izas_1373",Vn="_videoStatusError_1izas_1381",zn="_videoStatusActive_1izas_1389",Hn="_streamIcon_1izas_1397",U={gamePage:jr,gameContainer:kr,header:Pr,title:Mr,gameControls:Dr,playerInfo:Ur,startButton:qr,copyButton:$r,backButton:Wr,errorActions:Vr,homeButton:zr,errorMessage:Hr,retryButton:Gr,loadingMessage:Yr,spinnerContainer:Kr,spinner:Jr,spin:Xr,lobbyInfo:Qr,gameArea:Zr,gameContent:en,gameDescription:tn,videoGrid:rn,videoBox:nn,playerVideoContainer:on,videoWrapper:sn,playerVideo:an,placeholderVideo:ln,placeholderContent:cn,noVideoText:un,userIcon:fn,playerName:hn,playerCharacter:dn,mediaControls:pn,mutedIcon:gn,videoDisabled:_n,noVideoIcon:yn,localVideo:mn,videoControls:wn,videoOn:bn,videoOff:En,audioOn:vn,audioOff:Rn,noPlayersMessage:Cn,mediaButton:Sn,mediaButtonActive:xn,mediaButtonDisabled:Tn,cameraOffOverlay:An,cameraOffIcon:Nn,lobby:Bn,streamError:In,streamErrorIcon:Fn,streamErrorText:On,altButton:Ln,videoPlaceholder:jn,errorModal:kn,errorContent:Pn,continueButton:Mn,formButtons:Dn,assignButton:Un,characterForm:qn,videoStatus:$n,videoStatusConnecting:Wn,videoStatusError:Vn,videoStatusActive:zn,streamIcon:Hn};var dt={exports:{}},Qe,Rt;function Gn(){if(Rt)return Qe;Rt=1;var i=1e3,e=i*60,n=e*60,s=n*24,c=s*7,h=s*365.25;Qe=function(b,y){y=y||{};var F=typeof b;if(F==="string"&&b.length>0)return d(b);if(F==="number"&&isFinite(b))return y.long?R(b):f(b);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(b))};function d(b){if(b=String(b),!(b.length>100)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(b);if(y){var F=parseFloat(y[1]),k=(y[2]||"ms").toLowerCase();switch(k){case"years":case"year":case"yrs":case"yr":case"y":return F*h;case"weeks":case"week":case"w":return F*c;case"days":case"day":case"d":return F*s;case"hours":case"hour":case"hrs":case"hr":case"h":return F*n;case"minutes":case"minute":case"mins":case"min":case"m":return F*e;case"seconds":case"second":case"secs":case"sec":case"s":return F*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return F;default:return}}}}function f(b){var y=Math.abs(b);return y>=s?Math.round(b/s)+"d":y>=n?Math.round(b/n)+"h":y>=e?Math.round(b/e)+"m":y>=i?Math.round(b/i)+"s":b+"ms"}function R(b){var y=Math.abs(b);return y>=s?E(b,y,s,"day"):y>=n?E(b,y,n,"hour"):y>=e?E(b,y,e,"minute"):y>=i?E(b,y,i,"second"):b+" ms"}function E(b,y,F,k){var O=y>=F*1.5;return Math.round(b/F)+" "+k+(O?"s":"")}return Qe}function Yn(i){n.debug=n,n.default=n,n.coerce=R,n.disable=d,n.enable=c,n.enabled=f,n.humanize=Gn(),n.destroy=E,Object.keys(i).forEach(b=>{n[b]=i[b]}),n.names=[],n.skips=[],n.formatters={};function e(b){let y=0;for(let F=0;F<b.length;F++)y=(y<<5)-y+b.charCodeAt(F),y|=0;return n.colors[Math.abs(y)%n.colors.length]}n.selectColor=e;function n(b){let y,F=null,k,O;function L(...N){if(!L.enabled)return;const p=L,x=Number(new Date),v=x-(y||x);p.diff=v,p.prev=y,p.curr=x,y=x,N[0]=n.coerce(N[0]),typeof N[0]!="string"&&N.unshift("%O");let B=0;N[0]=N[0].replace(/%([a-zA-Z%])/g,(P,J)=>{if(P==="%%")return"%";B++;const $=n.formatters[J];if(typeof $=="function"){const q=N[B];P=$.call(p,q),N.splice(B,1),B--}return P}),n.formatArgs.call(p,N),(p.log||n.log).apply(p,N)}return L.namespace=b,L.useColors=n.useColors(),L.color=n.selectColor(b),L.extend=s,L.destroy=n.destroy,Object.defineProperty(L,"enabled",{enumerable:!0,configurable:!1,get:()=>F!==null?F:(k!==n.namespaces&&(k=n.namespaces,O=n.enabled(b)),O),set:N=>{F=N}}),typeof n.init=="function"&&n.init(L),L}function s(b,y){const F=n(this.namespace+(typeof y>"u"?":":y)+b);return F.log=this.log,F}function c(b){n.save(b),n.namespaces=b,n.names=[],n.skips=[];const y=(typeof b=="string"?b:"").trim().replace(" ",",").split(",").filter(Boolean);for(const F of y)F[0]==="-"?n.skips.push(F.slice(1)):n.names.push(F)}function h(b,y){let F=0,k=0,O=-1,L=0;for(;F<b.length;)if(k<y.length&&(y[k]===b[F]||y[k]==="*"))y[k]==="*"?(O=k,L=F,k++):(F++,k++);else if(O!==-1)k=O+1,L++,F=L;else return!1;for(;k<y.length&&y[k]==="*";)k++;return k===y.length}function d(){const b=[...n.names,...n.skips.map(y=>"-"+y)].join(",");return n.enable(""),b}function f(b){for(const y of n.skips)if(h(b,y))return!1;for(const y of n.names)if(h(b,y))return!0;return!1}function R(b){return b instanceof Error?b.stack||b.message:b}function E(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var Kn=Yn;(function(i,e){var n={};e.formatArgs=c,e.save=h,e.load=d,e.useColors=s,e.storage=f(),e.destroy=(()=>{let E=!1;return()=>{E||(E=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let E;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(E=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(E[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function c(E){if(E[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+E[0]+(this.useColors?"%c ":" ")+"+"+i.exports.humanize(this.diff),!this.useColors)return;const b="color: "+this.color;E.splice(1,0,b,"color: inherit");let y=0,F=0;E[0].replace(/%[a-zA-Z%]/g,k=>{k!=="%%"&&(y++,k==="%c"&&(F=y))}),E.splice(F,0,b)}e.log=console.debug||console.log||(()=>{});function h(E){try{E?e.storage.setItem("debug",E):e.storage.removeItem("debug")}catch{}}function d(){let E;try{E=e.storage.getItem("debug")}catch{}return!E&&typeof process<"u"&&"env"in process&&(E=n.DEBUG),E}function f(){try{return localStorage}catch{}}i.exports=Kn(e);const{formatters:R}=i.exports;R.j=function(E){try{return JSON.stringify(E)}catch(b){return"[UnexpectedJSONParseError]: "+b.message}}})(dt,dt.exports);var Jn=dt.exports,Xn=function(){if(typeof globalThis>"u")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},pt={exports:{}},gt={exports:{}},ke={},Ye={};Ye.byteLength=ei;Ye.toByteArray=ri;Ye.fromByteArray=oi;var ye=[],pe=[],Qn=typeof Uint8Array<"u"?Uint8Array:Array,Ze="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Oe=0,Zn=Ze.length;Oe<Zn;++Oe)ye[Oe]=Ze[Oe],pe[Ze.charCodeAt(Oe)]=Oe;pe[45]=62;pe[95]=63;function Kt(i){var e=i.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=i.indexOf("=");n===-1&&(n=e);var s=n===e?0:4-n%4;return[n,s]}function ei(i){var e=Kt(i),n=e[0],s=e[1];return(n+s)*3/4-s}function ti(i,e,n){return(e+n)*3/4-n}function ri(i){var e,n=Kt(i),s=n[0],c=n[1],h=new Qn(ti(i,s,c)),d=0,f=c>0?s-4:s,R;for(R=0;R<f;R+=4)e=pe[i.charCodeAt(R)]<<18|pe[i.charCodeAt(R+1)]<<12|pe[i.charCodeAt(R+2)]<<6|pe[i.charCodeAt(R+3)],h[d++]=e>>16&255,h[d++]=e>>8&255,h[d++]=e&255;return c===2&&(e=pe[i.charCodeAt(R)]<<2|pe[i.charCodeAt(R+1)]>>4,h[d++]=e&255),c===1&&(e=pe[i.charCodeAt(R)]<<10|pe[i.charCodeAt(R+1)]<<4|pe[i.charCodeAt(R+2)]>>2,h[d++]=e>>8&255,h[d++]=e&255),h}function ni(i){return ye[i>>18&63]+ye[i>>12&63]+ye[i>>6&63]+ye[i&63]}function ii(i,e,n){for(var s,c=[],h=e;h<n;h+=3)s=(i[h]<<16&16711680)+(i[h+1]<<8&65280)+(i[h+2]&255),c.push(ni(s));return c.join("")}function oi(i){for(var e,n=i.length,s=n%3,c=[],h=16383,d=0,f=n-s;d<f;d+=h)c.push(ii(i,d,d+h>f?f:d+h));return s===1?(e=i[n-1],c.push(ye[e>>2]+ye[e<<4&63]+"==")):s===2&&(e=(i[n-2]<<8)+i[n-1],c.push(ye[e>>10]+ye[e>>4&63]+ye[e<<2&63]+"=")),c.join("")}var wt={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */wt.read=function(i,e,n,s,c){var h,d,f=c*8-s-1,R=(1<<f)-1,E=R>>1,b=-7,y=n?c-1:0,F=n?-1:1,k=i[e+y];for(y+=F,h=k&(1<<-b)-1,k>>=-b,b+=f;b>0;h=h*256+i[e+y],y+=F,b-=8);for(d=h&(1<<-b)-1,h>>=-b,b+=s;b>0;d=d*256+i[e+y],y+=F,b-=8);if(h===0)h=1-E;else{if(h===R)return d?NaN:(k?-1:1)*(1/0);d=d+Math.pow(2,s),h=h-E}return(k?-1:1)*d*Math.pow(2,h-s)};wt.write=function(i,e,n,s,c,h){var d,f,R,E=h*8-c-1,b=(1<<E)-1,y=b>>1,F=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=s?0:h-1,O=s?1:-1,L=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,d=b):(d=Math.floor(Math.log(e)/Math.LN2),e*(R=Math.pow(2,-d))<1&&(d--,R*=2),d+y>=1?e+=F/R:e+=F*Math.pow(2,1-y),e*R>=2&&(d++,R/=2),d+y>=b?(f=0,d=b):d+y>=1?(f=(e*R-1)*Math.pow(2,c),d=d+y):(f=e*Math.pow(2,y-1)*Math.pow(2,c),d=0));c>=8;i[n+k]=f&255,k+=O,f/=256,c-=8);for(d=d<<c|f,E+=c;E>0;i[n+k]=d&255,k+=O,d/=256,E-=8);i[n+k-O]|=L*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(i){const e=Ye,n=wt,s=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;i.Buffer=f,i.SlowBuffer=x,i.INSPECT_MAX_BYTES=50;const c=2147483647;i.kMaxLength=c,f.TYPED_ARRAY_SUPPORT=h(),!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function h(){try{const o=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(o,t),o.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function d(o){if(o>c)throw new RangeError('The value "'+o+'" is invalid for option "size"');const t=new Uint8Array(o);return Object.setPrototypeOf(t,f.prototype),t}function f(o,t,r){if(typeof o=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(o)}return R(o,t,r)}f.poolSize=8192;function R(o,t,r){if(typeof o=="string")return F(o,t);if(ArrayBuffer.isView(o))return O(o);if(o==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o);if(he(o,ArrayBuffer)||o&&he(o.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(he(o,SharedArrayBuffer)||o&&he(o.buffer,SharedArrayBuffer)))return L(o,t,r);if(typeof o=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const a=o.valueOf&&o.valueOf();if(a!=null&&a!==o)return f.from(a,t,r);const g=N(o);if(g)return g;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof o[Symbol.toPrimitive]=="function")return f.from(o[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o)}f.from=function(o,t,r){return R(o,t,r)},Object.setPrototypeOf(f.prototype,Uint8Array.prototype),Object.setPrototypeOf(f,Uint8Array);function E(o){if(typeof o!="number")throw new TypeError('"size" argument must be of type number');if(o<0)throw new RangeError('The value "'+o+'" is invalid for option "size"')}function b(o,t,r){return E(o),o<=0?d(o):t!==void 0?typeof r=="string"?d(o).fill(t,r):d(o).fill(t):d(o)}f.alloc=function(o,t,r){return b(o,t,r)};function y(o){return E(o),d(o<0?0:p(o)|0)}f.allocUnsafe=function(o){return y(o)},f.allocUnsafeSlow=function(o){return y(o)};function F(o,t){if((typeof t!="string"||t==="")&&(t="utf8"),!f.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=v(o,t)|0;let a=d(r);const g=a.write(o,t);return g!==r&&(a=a.slice(0,g)),a}function k(o){const t=o.length<0?0:p(o.length)|0,r=d(t);for(let a=0;a<t;a+=1)r[a]=o[a]&255;return r}function O(o){if(he(o,Uint8Array)){const t=new Uint8Array(o);return L(t.buffer,t.byteOffset,t.byteLength)}return k(o)}function L(o,t,r){if(t<0||o.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(o.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let a;return t===void 0&&r===void 0?a=new Uint8Array(o):r===void 0?a=new Uint8Array(o,t):a=new Uint8Array(o,t,r),Object.setPrototypeOf(a,f.prototype),a}function N(o){if(f.isBuffer(o)){const t=p(o.length)|0,r=d(t);return r.length===0||o.copy(r,0,0,t),r}if(o.length!==void 0)return typeof o.length!="number"||Ce(o.length)?d(0):k(o);if(o.type==="Buffer"&&Array.isArray(o.data))return k(o.data)}function p(o){if(o>=c)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+c.toString(16)+" bytes");return o|0}function x(o){return+o!=o&&(o=0),f.alloc(+o)}f.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==f.prototype},f.compare=function(t,r){if(he(t,Uint8Array)&&(t=f.from(t,t.offset,t.byteLength)),he(r,Uint8Array)&&(r=f.from(r,r.offset,r.byteLength)),!f.isBuffer(t)||!f.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;let a=t.length,g=r.length;for(let m=0,S=Math.min(a,g);m<S;++m)if(t[m]!==r[m]){a=t[m],g=r[m];break}return a<g?-1:g<a?1:0},f.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(t,r){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return f.alloc(0);let a;if(r===void 0)for(r=0,a=0;a<t.length;++a)r+=t[a].length;const g=f.allocUnsafe(r);let m=0;for(a=0;a<t.length;++a){let S=t[a];if(he(S,Uint8Array))m+S.length>g.length?(f.isBuffer(S)||(S=f.from(S)),S.copy(g,m)):Uint8Array.prototype.set.call(g,S,m);else if(f.isBuffer(S))S.copy(g,m);else throw new TypeError('"list" argument must be an Array of Buffers');m+=S.length}return g};function v(o,t){if(f.isBuffer(o))return o.length;if(ArrayBuffer.isView(o)||he(o,ArrayBuffer))return o.byteLength;if(typeof o!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof o);const r=o.length,a=arguments.length>2&&arguments[2]===!0;if(!a&&r===0)return 0;let g=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return K(o).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return Pe(o).length;default:if(g)return a?-1:K(o).length;t=(""+t).toLowerCase(),g=!0}}f.byteLength=v;function B(o,t,r){let a=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((r===void 0||r>this.length)&&(r=this.length),r<=0)||(r>>>=0,t>>>=0,r<=t))return"";for(o||(o="utf8");;)switch(o){case"hex":return le(this,t,r);case"utf8":case"utf-8":return oe(this,t,r);case"ascii":return W(this,t,r);case"latin1":case"binary":return ee(this,t,r);case"base64":return M(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ee(this,t,r);default:if(a)throw new TypeError("Unknown encoding: "+o);o=(o+"").toLowerCase(),a=!0}}f.prototype._isBuffer=!0;function I(o,t,r){const a=o[t];o[t]=o[r],o[r]=a}f.prototype.swap16=function(){const t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let r=0;r<t;r+=2)I(this,r,r+1);return this},f.prototype.swap32=function(){const t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let r=0;r<t;r+=4)I(this,r,r+3),I(this,r+1,r+2);return this},f.prototype.swap64=function(){const t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let r=0;r<t;r+=8)I(this,r,r+7),I(this,r+1,r+6),I(this,r+2,r+5),I(this,r+3,r+4);return this},f.prototype.toString=function(){const t=this.length;return t===0?"":arguments.length===0?oe(this,0,t):B.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(t){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:f.compare(this,t)===0},f.prototype.inspect=function(){let t="";const r=i.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},s&&(f.prototype[s]=f.prototype.inspect),f.prototype.compare=function(t,r,a,g,m){if(he(t,Uint8Array)&&(t=f.from(t,t.offset,t.byteLength)),!f.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(r===void 0&&(r=0),a===void 0&&(a=t?t.length:0),g===void 0&&(g=0),m===void 0&&(m=this.length),r<0||a>t.length||g<0||m>this.length)throw new RangeError("out of range index");if(g>=m&&r>=a)return 0;if(g>=m)return-1;if(r>=a)return 1;if(r>>>=0,a>>>=0,g>>>=0,m>>>=0,this===t)return 0;let S=m-g,H=a-r;const se=Math.min(S,H),ne=this.slice(g,m),ae=t.slice(r,a);for(let Q=0;Q<se;++Q)if(ne[Q]!==ae[Q]){S=ne[Q],H=ae[Q];break}return S<H?-1:H<S?1:0};function P(o,t,r,a,g){if(o.length===0)return-1;if(typeof r=="string"?(a=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,Ce(r)&&(r=g?0:o.length-1),r<0&&(r=o.length+r),r>=o.length){if(g)return-1;r=o.length-1}else if(r<0)if(g)r=0;else return-1;if(typeof t=="string"&&(t=f.from(t,a)),f.isBuffer(t))return t.length===0?-1:J(o,t,r,a,g);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?g?Uint8Array.prototype.indexOf.call(o,t,r):Uint8Array.prototype.lastIndexOf.call(o,t,r):J(o,[t],r,a,g);throw new TypeError("val must be string, number or Buffer")}function J(o,t,r,a,g){let m=1,S=o.length,H=t.length;if(a!==void 0&&(a=String(a).toLowerCase(),a==="ucs2"||a==="ucs-2"||a==="utf16le"||a==="utf-16le")){if(o.length<2||t.length<2)return-1;m=2,S/=2,H/=2,r/=2}function se(ae,Q){return m===1?ae[Q]:ae.readUInt16BE(Q*m)}let ne;if(g){let ae=-1;for(ne=r;ne<S;ne++)if(se(o,ne)===se(t,ae===-1?0:ne-ae)){if(ae===-1&&(ae=ne),ne-ae+1===H)return ae*m}else ae!==-1&&(ne-=ne-ae),ae=-1}else for(r+H>S&&(r=S-H),ne=r;ne>=0;ne--){let ae=!0;for(let Q=0;Q<H;Q++)if(se(o,ne+Q)!==se(t,Q)){ae=!1;break}if(ae)return ne}return-1}f.prototype.includes=function(t,r,a){return this.indexOf(t,r,a)!==-1},f.prototype.indexOf=function(t,r,a){return P(this,t,r,a,!0)},f.prototype.lastIndexOf=function(t,r,a){return P(this,t,r,a,!1)};function $(o,t,r,a){r=Number(r)||0;const g=o.length-r;a?(a=Number(a),a>g&&(a=g)):a=g;const m=t.length;a>m/2&&(a=m/2);let S;for(S=0;S<a;++S){const H=parseInt(t.substr(S*2,2),16);if(Ce(H))return S;o[r+S]=H}return S}function q(o,t,r,a){return Fe(K(t,o.length-r),o,r,a)}function fe(o,t,r,a){return Fe(ve(t),o,r,a)}function me(o,t,r,a){return Fe(Pe(t),o,r,a)}function be(o,t,r,a){return Fe(Ie(t,o.length-r),o,r,a)}f.prototype.write=function(t,r,a,g){if(r===void 0)g="utf8",a=this.length,r=0;else if(a===void 0&&typeof r=="string")g=r,a=this.length,r=0;else if(isFinite(r))r=r>>>0,isFinite(a)?(a=a>>>0,g===void 0&&(g="utf8")):(g=a,a=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const m=this.length-r;if((a===void 0||a>m)&&(a=m),t.length>0&&(a<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");g||(g="utf8");let S=!1;for(;;)switch(g){case"hex":return $(this,t,r,a);case"utf8":case"utf-8":return q(this,t,r,a);case"ascii":case"latin1":case"binary":return fe(this,t,r,a);case"base64":return me(this,t,r,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return be(this,t,r,a);default:if(S)throw new TypeError("Unknown encoding: "+g);g=(""+g).toLowerCase(),S=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function M(o,t,r){return t===0&&r===o.length?e.fromByteArray(o):e.fromByteArray(o.slice(t,r))}function oe(o,t,r){r=Math.min(o.length,r);const a=[];let g=t;for(;g<r;){const m=o[g];let S=null,H=m>239?4:m>223?3:m>191?2:1;if(g+H<=r){let se,ne,ae,Q;switch(H){case 1:m<128&&(S=m);break;case 2:se=o[g+1],(se&192)===128&&(Q=(m&31)<<6|se&63,Q>127&&(S=Q));break;case 3:se=o[g+1],ne=o[g+2],(se&192)===128&&(ne&192)===128&&(Q=(m&15)<<12|(se&63)<<6|ne&63,Q>2047&&(Q<55296||Q>57343)&&(S=Q));break;case 4:se=o[g+1],ne=o[g+2],ae=o[g+3],(se&192)===128&&(ne&192)===128&&(ae&192)===128&&(Q=(m&15)<<18|(se&63)<<12|(ne&63)<<6|ae&63,Q>65535&&Q<1114112&&(S=Q))}}S===null?(S=65533,H=1):S>65535&&(S-=65536,a.push(S>>>10&1023|55296),S=56320|S&1023),a.push(S),g+=H}return Z(a)}const ue=4096;function Z(o){const t=o.length;if(t<=ue)return String.fromCharCode.apply(String,o);let r="",a=0;for(;a<t;)r+=String.fromCharCode.apply(String,o.slice(a,a+=ue));return r}function W(o,t,r){let a="";r=Math.min(o.length,r);for(let g=t;g<r;++g)a+=String.fromCharCode(o[g]&127);return a}function ee(o,t,r){let a="";r=Math.min(o.length,r);for(let g=t;g<r;++g)a+=String.fromCharCode(o[g]);return a}function le(o,t,r){const a=o.length;(!t||t<0)&&(t=0),(!r||r<0||r>a)&&(r=a);let g="";for(let m=t;m<r;++m)g+=Me[o[m]];return g}function Ee(o,t,r){const a=o.slice(t,r);let g="";for(let m=0;m<a.length-1;m+=2)g+=String.fromCharCode(a[m]+a[m+1]*256);return g}f.prototype.slice=function(t,r){const a=this.length;t=~~t,r=r===void 0?a:~~r,t<0?(t+=a,t<0&&(t=0)):t>a&&(t=a),r<0?(r+=a,r<0&&(r=0)):r>a&&(r=a),r<t&&(r=t);const g=this.subarray(t,r);return Object.setPrototypeOf(g,f.prototype),g};function te(o,t,r){if(o%1!==0||o<0)throw new RangeError("offset is not uint");if(o+t>r)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(t,r,a){t=t>>>0,r=r>>>0,a||te(t,r,this.length);let g=this[t],m=1,S=0;for(;++S<r&&(m*=256);)g+=this[t+S]*m;return g},f.prototype.readUintBE=f.prototype.readUIntBE=function(t,r,a){t=t>>>0,r=r>>>0,a||te(t,r,this.length);let g=this[t+--r],m=1;for(;r>0&&(m*=256);)g+=this[t+--r]*m;return g},f.prototype.readUint8=f.prototype.readUInt8=function(t,r){return t=t>>>0,r||te(t,1,this.length),this[t]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(t,r){return t=t>>>0,r||te(t,2,this.length),this[t]|this[t+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(t,r){return t=t>>>0,r||te(t,2,this.length),this[t]<<8|this[t+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(t,r){return t=t>>>0,r||te(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(t,r){return t=t>>>0,r||te(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])},f.prototype.readBigUInt64LE=de(function(t){t=t>>>0,T(t,"offset");const r=this[t],a=this[t+7];(r===void 0||a===void 0)&&j(t,this.length-8);const g=r+this[++t]*2**8+this[++t]*2**16+this[++t]*2**24,m=this[++t]+this[++t]*2**8+this[++t]*2**16+a*2**24;return BigInt(g)+(BigInt(m)<<BigInt(32))}),f.prototype.readBigUInt64BE=de(function(t){t=t>>>0,T(t,"offset");const r=this[t],a=this[t+7];(r===void 0||a===void 0)&&j(t,this.length-8);const g=r*2**24+this[++t]*2**16+this[++t]*2**8+this[++t],m=this[++t]*2**24+this[++t]*2**16+this[++t]*2**8+a;return(BigInt(g)<<BigInt(32))+BigInt(m)}),f.prototype.readIntLE=function(t,r,a){t=t>>>0,r=r>>>0,a||te(t,r,this.length);let g=this[t],m=1,S=0;for(;++S<r&&(m*=256);)g+=this[t+S]*m;return m*=128,g>=m&&(g-=Math.pow(2,8*r)),g},f.prototype.readIntBE=function(t,r,a){t=t>>>0,r=r>>>0,a||te(t,r,this.length);let g=r,m=1,S=this[t+--g];for(;g>0&&(m*=256);)S+=this[t+--g]*m;return m*=128,S>=m&&(S-=Math.pow(2,8*r)),S},f.prototype.readInt8=function(t,r){return t=t>>>0,r||te(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]},f.prototype.readInt16LE=function(t,r){t=t>>>0,r||te(t,2,this.length);const a=this[t]|this[t+1]<<8;return a&32768?a|4294901760:a},f.prototype.readInt16BE=function(t,r){t=t>>>0,r||te(t,2,this.length);const a=this[t+1]|this[t]<<8;return a&32768?a|4294901760:a},f.prototype.readInt32LE=function(t,r){return t=t>>>0,r||te(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},f.prototype.readInt32BE=function(t,r){return t=t>>>0,r||te(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},f.prototype.readBigInt64LE=de(function(t){t=t>>>0,T(t,"offset");const r=this[t],a=this[t+7];(r===void 0||a===void 0)&&j(t,this.length-8);const g=this[t+4]+this[t+5]*2**8+this[t+6]*2**16+(a<<24);return(BigInt(g)<<BigInt(32))+BigInt(r+this[++t]*2**8+this[++t]*2**16+this[++t]*2**24)}),f.prototype.readBigInt64BE=de(function(t){t=t>>>0,T(t,"offset");const r=this[t],a=this[t+7];(r===void 0||a===void 0)&&j(t,this.length-8);const g=(r<<24)+this[++t]*2**16+this[++t]*2**8+this[++t];return(BigInt(g)<<BigInt(32))+BigInt(this[++t]*2**24+this[++t]*2**16+this[++t]*2**8+a)}),f.prototype.readFloatLE=function(t,r){return t=t>>>0,r||te(t,4,this.length),n.read(this,t,!0,23,4)},f.prototype.readFloatBE=function(t,r){return t=t>>>0,r||te(t,4,this.length),n.read(this,t,!1,23,4)},f.prototype.readDoubleLE=function(t,r){return t=t>>>0,r||te(t,8,this.length),n.read(this,t,!0,52,8)},f.prototype.readDoubleBE=function(t,r){return t=t>>>0,r||te(t,8,this.length),n.read(this,t,!1,52,8)};function ce(o,t,r,a,g,m){if(!f.isBuffer(o))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>g||t<m)throw new RangeError('"value" argument is out of bounds');if(r+a>o.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(t,r,a,g){if(t=+t,r=r>>>0,a=a>>>0,!g){const H=Math.pow(2,8*a)-1;ce(this,t,r,a,H,0)}let m=1,S=0;for(this[r]=t&255;++S<a&&(m*=256);)this[r+S]=t/m&255;return r+a},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(t,r,a,g){if(t=+t,r=r>>>0,a=a>>>0,!g){const H=Math.pow(2,8*a)-1;ce(this,t,r,a,H,0)}let m=a-1,S=1;for(this[r+m]=t&255;--m>=0&&(S*=256);)this[r+m]=t/S&255;return r+a},f.prototype.writeUint8=f.prototype.writeUInt8=function(t,r,a){return t=+t,r=r>>>0,a||ce(this,t,r,1,255,0),this[r]=t&255,r+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(t,r,a){return t=+t,r=r>>>0,a||ce(this,t,r,2,65535,0),this[r]=t&255,this[r+1]=t>>>8,r+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(t,r,a){return t=+t,r=r>>>0,a||ce(this,t,r,2,65535,0),this[r]=t>>>8,this[r+1]=t&255,r+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(t,r,a){return t=+t,r=r>>>0,a||ce(this,t,r,4,4294967295,0),this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=t&255,r+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(t,r,a){return t=+t,r=r>>>0,a||ce(this,t,r,4,4294967295,0),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=t&255,r+4};function _e(o,t,r,a,g){u(t,a,g,o,r,7);let m=Number(t&BigInt(4294967295));o[r++]=m,m=m>>8,o[r++]=m,m=m>>8,o[r++]=m,m=m>>8,o[r++]=m;let S=Number(t>>BigInt(32)&BigInt(4294967295));return o[r++]=S,S=S>>8,o[r++]=S,S=S>>8,o[r++]=S,S=S>>8,o[r++]=S,r}function Ne(o,t,r,a,g){u(t,a,g,o,r,7);let m=Number(t&BigInt(4294967295));o[r+7]=m,m=m>>8,o[r+6]=m,m=m>>8,o[r+5]=m,m=m>>8,o[r+4]=m;let S=Number(t>>BigInt(32)&BigInt(4294967295));return o[r+3]=S,S=S>>8,o[r+2]=S,S=S>>8,o[r+1]=S,S=S>>8,o[r]=S,r+8}f.prototype.writeBigUInt64LE=de(function(t,r=0){return _e(this,t,r,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeBigUInt64BE=de(function(t,r=0){return Ne(this,t,r,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeIntLE=function(t,r,a,g){if(t=+t,r=r>>>0,!g){const se=Math.pow(2,8*a-1);ce(this,t,r,a,se-1,-se)}let m=0,S=1,H=0;for(this[r]=t&255;++m<a&&(S*=256);)t<0&&H===0&&this[r+m-1]!==0&&(H=1),this[r+m]=(t/S>>0)-H&255;return r+a},f.prototype.writeIntBE=function(t,r,a,g){if(t=+t,r=r>>>0,!g){const se=Math.pow(2,8*a-1);ce(this,t,r,a,se-1,-se)}let m=a-1,S=1,H=0;for(this[r+m]=t&255;--m>=0&&(S*=256);)t<0&&H===0&&this[r+m+1]!==0&&(H=1),this[r+m]=(t/S>>0)-H&255;return r+a},f.prototype.writeInt8=function(t,r,a){return t=+t,r=r>>>0,a||ce(this,t,r,1,127,-128),t<0&&(t=255+t+1),this[r]=t&255,r+1},f.prototype.writeInt16LE=function(t,r,a){return t=+t,r=r>>>0,a||ce(this,t,r,2,32767,-32768),this[r]=t&255,this[r+1]=t>>>8,r+2},f.prototype.writeInt16BE=function(t,r,a){return t=+t,r=r>>>0,a||ce(this,t,r,2,32767,-32768),this[r]=t>>>8,this[r+1]=t&255,r+2},f.prototype.writeInt32LE=function(t,r,a){return t=+t,r=r>>>0,a||ce(this,t,r,4,2147483647,-2147483648),this[r]=t&255,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24,r+4},f.prototype.writeInt32BE=function(t,r,a){return t=+t,r=r>>>0,a||ce(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=t&255,r+4},f.prototype.writeBigInt64LE=de(function(t,r=0){return _e(this,t,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),f.prototype.writeBigInt64BE=de(function(t,r=0){return Ne(this,t,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Be(o,t,r,a,g,m){if(r+a>o.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function w(o,t,r,a,g){return t=+t,r=r>>>0,g||Be(o,t,r,4),n.write(o,t,r,a,23,4),r+4}f.prototype.writeFloatLE=function(t,r,a){return w(this,t,r,!0,a)},f.prototype.writeFloatBE=function(t,r,a){return w(this,t,r,!1,a)};function _(o,t,r,a,g){return t=+t,r=r>>>0,g||Be(o,t,r,8),n.write(o,t,r,a,52,8),r+8}f.prototype.writeDoubleLE=function(t,r,a){return _(this,t,r,!0,a)},f.prototype.writeDoubleBE=function(t,r,a){return _(this,t,r,!1,a)},f.prototype.copy=function(t,r,a,g){if(!f.isBuffer(t))throw new TypeError("argument should be a Buffer");if(a||(a=0),!g&&g!==0&&(g=this.length),r>=t.length&&(r=t.length),r||(r=0),g>0&&g<a&&(g=a),g===a||t.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("sourceEnd out of bounds");g>this.length&&(g=this.length),t.length-r<g-a&&(g=t.length-r+a);const m=g-a;return this===t&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(r,a,g):Uint8Array.prototype.set.call(t,this.subarray(a,g),r),m},f.prototype.fill=function(t,r,a,g){if(typeof t=="string"){if(typeof r=="string"?(g=r,r=0,a=this.length):typeof a=="string"&&(g=a,a=this.length),g!==void 0&&typeof g!="string")throw new TypeError("encoding must be a string");if(typeof g=="string"&&!f.isEncoding(g))throw new TypeError("Unknown encoding: "+g);if(t.length===1){const S=t.charCodeAt(0);(g==="utf8"&&S<128||g==="latin1")&&(t=S)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(r<0||this.length<r||this.length<a)throw new RangeError("Out of range index");if(a<=r)return this;r=r>>>0,a=a===void 0?this.length:a>>>0,t||(t=0);let m;if(typeof t=="number")for(m=r;m<a;++m)this[m]=t;else{const S=f.isBuffer(t)?t:f.from(t,g),H=S.length;if(H===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(m=0;m<a-r;++m)this[m+r]=S[m%H]}return this};const A={};function D(o,t,r){A[o]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${o}]`,this.stack,delete this.name}get code(){return o}set code(g){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:g,writable:!0})}toString(){return`${this.name} [${o}]: ${this.message}`}}}D("ERR_BUFFER_OUT_OF_BOUNDS",function(o){return o?`${o} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),D("ERR_INVALID_ARG_TYPE",function(o,t){return`The "${o}" argument must be of type number. Received type ${typeof t}`},TypeError),D("ERR_OUT_OF_RANGE",function(o,t,r){let a=`The value of "${o}" is out of range.`,g=r;return Number.isInteger(r)&&Math.abs(r)>2**32?g=V(String(r)):typeof r=="bigint"&&(g=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(g=V(g)),g+="n"),a+=` It must be ${t}. Received ${g}`,a},RangeError);function V(o){let t="",r=o.length;const a=o[0]==="-"?1:0;for(;r>=a+4;r-=3)t=`_${o.slice(r-3,r)}${t}`;return`${o.slice(0,r)}${t}`}function l(o,t,r){T(t,"offset"),(o[t]===void 0||o[t+r]===void 0)&&j(t,o.length-(r+1))}function u(o,t,r,a,g,m){if(o>r||o<t){const S=typeof t=="bigint"?"n":"";let H;throw t===0||t===BigInt(0)?H=`>= 0${S} and < 2${S} ** ${(m+1)*8}${S}`:H=`>= -(2${S} ** ${(m+1)*8-1}${S}) and < 2 ** ${(m+1)*8-1}${S}`,new A.ERR_OUT_OF_RANGE("value",H,o)}l(a,g,m)}function T(o,t){if(typeof o!="number")throw new A.ERR_INVALID_ARG_TYPE(t,"number",o)}function j(o,t,r){throw Math.floor(o)!==o?(T(o,r),new A.ERR_OUT_OF_RANGE("offset","an integer",o)):t<0?new A.ERR_BUFFER_OUT_OF_BOUNDS:new A.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${t}`,o)}const re=/[^+/0-9A-Za-z-_]/g;function z(o){if(o=o.split("=")[0],o=o.trim().replace(re,""),o.length<2)return"";for(;o.length%4!==0;)o=o+"=";return o}function K(o,t){t=t||1/0;let r;const a=o.length;let g=null;const m=[];for(let S=0;S<a;++S){if(r=o.charCodeAt(S),r>55295&&r<57344){if(!g){if(r>56319){(t-=3)>-1&&m.push(239,191,189);continue}else if(S+1===a){(t-=3)>-1&&m.push(239,191,189);continue}g=r;continue}if(r<56320){(t-=3)>-1&&m.push(239,191,189),g=r;continue}r=(g-55296<<10|r-56320)+65536}else g&&(t-=3)>-1&&m.push(239,191,189);if(g=null,r<128){if((t-=1)<0)break;m.push(r)}else if(r<2048){if((t-=2)<0)break;m.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;m.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;m.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return m}function ve(o){const t=[];for(let r=0;r<o.length;++r)t.push(o.charCodeAt(r)&255);return t}function Ie(o,t){let r,a,g;const m=[];for(let S=0;S<o.length&&!((t-=2)<0);++S)r=o.charCodeAt(S),a=r>>8,g=r%256,m.push(g),m.push(a);return m}function Pe(o){return e.toByteArray(z(o))}function Fe(o,t,r,a){let g;for(g=0;g<a&&!(g+r>=t.length||g>=o.length);++g)t[g+r]=o[g];return g}function he(o,t){return o instanceof t||o!=null&&o.constructor!=null&&o.constructor.name!=null&&o.constructor.name===t.name}function Ce(o){return o!==o}const Me=function(){const o="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const a=r*16;for(let g=0;g<16;++g)t[a+g]=o[r]+o[g]}return t}();function de(o){return typeof BigInt>"u"?Se:o}function Se(){throw new Error("BigInt not supported")}})(ke);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(i,e){var n=ke,s=n.Buffer;function c(d,f){for(var R in d)f[R]=d[R]}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?i.exports=n:(c(n,e),e.Buffer=h);function h(d,f,R){return s(d,f,R)}h.prototype=Object.create(s.prototype),c(s,h),h.from=function(d,f,R){if(typeof d=="number")throw new TypeError("Argument must not be a number");return s(d,f,R)},h.alloc=function(d,f,R){if(typeof d!="number")throw new TypeError("Argument must be a number");var E=s(d);return f!==void 0?typeof R=="string"?E.fill(f,R):E.fill(f):E.fill(0),E},h.allocUnsafe=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return s(d)},h.allocUnsafeSlow=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(d)}})(gt,gt.exports);var Jt=gt.exports,et=65536,si=4294967295;function ai(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var li=Jt.Buffer,He=window.crypto||window.msCrypto;He&&He.getRandomValues?pt.exports=ci:pt.exports=ai;function ci(i,e){if(i>si)throw new RangeError("requested too many random bytes");var n=li.allocUnsafe(i);if(i>0)if(i>et)for(var s=0;s<i;s+=et)He.getRandomValues(n.slice(s,s+et));else He.getRandomValues(n);return typeof e=="function"?process.nextTick(function(){e(null,n)}):n}var ui=pt.exports,_t={exports:{}},bt={exports:{}},Le=typeof Reflect=="object"?Reflect:null,Ct=Le&&typeof Le.apply=="function"?Le.apply:function(e,n,s){return Function.prototype.apply.call(e,n,s)},Ve;Le&&typeof Le.ownKeys=="function"?Ve=Le.ownKeys:Object.getOwnPropertySymbols?Ve=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Ve=function(e){return Object.getOwnPropertyNames(e)};function fi(i){console&&console.warn&&console.warn(i)}var Xt=Number.isNaN||function(e){return e!==e};function X(){X.init.call(this)}bt.exports=X;bt.exports.once=gi;X.EventEmitter=X;X.prototype._events=void 0;X.prototype._eventsCount=0;X.prototype._maxListeners=void 0;var St=10;function Ke(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(X,"defaultMaxListeners",{enumerable:!0,get:function(){return St},set:function(i){if(typeof i!="number"||i<0||Xt(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");St=i}});X.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};X.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Xt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Qt(i){return i._maxListeners===void 0?X.defaultMaxListeners:i._maxListeners}X.prototype.getMaxListeners=function(){return Qt(this)};X.prototype.emit=function(e){for(var n=[],s=1;s<arguments.length;s++)n.push(arguments[s]);var c=e==="error",h=this._events;if(h!==void 0)c=c&&h.error===void 0;else if(!c)return!1;if(c){var d;if(n.length>0&&(d=n[0]),d instanceof Error)throw d;var f=new Error("Unhandled error."+(d?" ("+d.message+")":""));throw f.context=d,f}var R=h[e];if(R===void 0)return!1;if(typeof R=="function")Ct(R,this,n);else for(var E=R.length,b=nr(R,E),s=0;s<E;++s)Ct(b[s],this,n);return!0};function Zt(i,e,n,s){var c,h,d;if(Ke(n),h=i._events,h===void 0?(h=i._events=Object.create(null),i._eventsCount=0):(h.newListener!==void 0&&(i.emit("newListener",e,n.listener?n.listener:n),h=i._events),d=h[e]),d===void 0)d=h[e]=n,++i._eventsCount;else if(typeof d=="function"?d=h[e]=s?[n,d]:[d,n]:s?d.unshift(n):d.push(n),c=Qt(i),c>0&&d.length>c&&!d.warned){d.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+d.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=i,f.type=e,f.count=d.length,fi(f)}return i}X.prototype.addListener=function(e,n){return Zt(this,e,n,!1)};X.prototype.on=X.prototype.addListener;X.prototype.prependListener=function(e,n){return Zt(this,e,n,!0)};function hi(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function er(i,e,n){var s={fired:!1,wrapFn:void 0,target:i,type:e,listener:n},c=hi.bind(s);return c.listener=n,s.wrapFn=c,c}X.prototype.once=function(e,n){return Ke(n),this.on(e,er(this,e,n)),this};X.prototype.prependOnceListener=function(e,n){return Ke(n),this.prependListener(e,er(this,e,n)),this};X.prototype.removeListener=function(e,n){var s,c,h,d,f;if(Ke(n),c=this._events,c===void 0)return this;if(s=c[e],s===void 0)return this;if(s===n||s.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete c[e],c.removeListener&&this.emit("removeListener",e,s.listener||n));else if(typeof s!="function"){for(h=-1,d=s.length-1;d>=0;d--)if(s[d]===n||s[d].listener===n){f=s[d].listener,h=d;break}if(h<0)return this;h===0?s.shift():di(s,h),s.length===1&&(c[e]=s[0]),c.removeListener!==void 0&&this.emit("removeListener",e,f||n)}return this};X.prototype.off=X.prototype.removeListener;X.prototype.removeAllListeners=function(e){var n,s,c;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var h=Object.keys(s),d;for(c=0;c<h.length;++c)d=h[c],d!=="removeListener"&&this.removeAllListeners(d);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=s[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(c=n.length-1;c>=0;c--)this.removeListener(e,n[c]);return this};function tr(i,e,n){var s=i._events;if(s===void 0)return[];var c=s[e];return c===void 0?[]:typeof c=="function"?n?[c.listener||c]:[c]:n?pi(c):nr(c,c.length)}X.prototype.listeners=function(e){return tr(this,e,!0)};X.prototype.rawListeners=function(e){return tr(this,e,!1)};X.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):rr.call(i,e)};X.prototype.listenerCount=rr;function rr(i){var e=this._events;if(e!==void 0){var n=e[i];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}X.prototype.eventNames=function(){return this._eventsCount>0?Ve(this._events):[]};function nr(i,e){for(var n=new Array(e),s=0;s<e;++s)n[s]=i[s];return n}function di(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function pi(i){for(var e=new Array(i.length),n=0;n<e.length;++n)e[n]=i[n].listener||i[n];return e}function gi(i,e){return new Promise(function(n,s){function c(d){i.removeListener(e,h),s(d)}function h(){typeof i.removeListener=="function"&&i.removeListener("error",c),n([].slice.call(arguments))}ir(i,e,h,{once:!0}),e!=="error"&&_i(i,c,{once:!0})})}function _i(i,e,n){typeof i.on=="function"&&ir(i,"error",e,n)}function ir(i,e,n,s){if(typeof i.on=="function")s.once?i.once(e,n):i.on(e,n);else if(typeof i.addEventListener=="function")i.addEventListener(e,function c(h){s.once&&i.removeEventListener(e,c),n(h)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var or=bt.exports,sr=or.EventEmitter;const yi={},mi=Object.freeze(Object.defineProperty({__proto__:null,default:yi},Symbol.toStringTag,{value:"Module"})),ar=wr(mi);var tt,xt;function wi(){if(xt)return tt;xt=1;function i(O,L){var N=Object.keys(O);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(O);L&&(p=p.filter(function(x){return Object.getOwnPropertyDescriptor(O,x).enumerable})),N.push.apply(N,p)}return N}function e(O){for(var L=1;L<arguments.length;L++){var N=arguments[L]!=null?arguments[L]:{};L%2?i(Object(N),!0).forEach(function(p){n(O,p,N[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(N)):i(Object(N)).forEach(function(p){Object.defineProperty(O,p,Object.getOwnPropertyDescriptor(N,p))})}return O}function n(O,L,N){return L=d(L),L in O?Object.defineProperty(O,L,{value:N,enumerable:!0,configurable:!0,writable:!0}):O[L]=N,O}function s(O,L){if(!(O instanceof L))throw new TypeError("Cannot call a class as a function")}function c(O,L){for(var N=0;N<L.length;N++){var p=L[N];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(O,d(p.key),p)}}function h(O,L,N){return L&&c(O.prototype,L),Object.defineProperty(O,"prototype",{writable:!1}),O}function d(O){var L=f(O,"string");return typeof L=="symbol"?L:String(L)}function f(O,L){if(typeof O!="object"||O===null)return O;var N=O[Symbol.toPrimitive];if(N!==void 0){var p=N.call(O,L);if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(O)}var R=ke,E=R.Buffer,b=ar,y=b.inspect,F=y&&y.custom||"inspect";function k(O,L,N){E.prototype.copy.call(O,L,N)}return tt=function(){function O(){s(this,O),this.head=null,this.tail=null,this.length=0}return h(O,[{key:"push",value:function(N){var p={data:N,next:null};this.length>0?this.tail.next=p:this.head=p,this.tail=p,++this.length}},{key:"unshift",value:function(N){var p={data:N,next:this.head};this.length===0&&(this.tail=p),this.head=p,++this.length}},{key:"shift",value:function(){if(this.length!==0){var N=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,N}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(N){if(this.length===0)return"";for(var p=this.head,x=""+p.data;p=p.next;)x+=N+p.data;return x}},{key:"concat",value:function(N){if(this.length===0)return E.alloc(0);for(var p=E.allocUnsafe(N>>>0),x=this.head,v=0;x;)k(x.data,p,v),v+=x.data.length,x=x.next;return p}},{key:"consume",value:function(N,p){var x;return N<this.head.data.length?(x=this.head.data.slice(0,N),this.head.data=this.head.data.slice(N)):N===this.head.data.length?x=this.shift():x=p?this._getString(N):this._getBuffer(N),x}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(N){var p=this.head,x=1,v=p.data;for(N-=v.length;p=p.next;){var B=p.data,I=N>B.length?B.length:N;if(I===B.length?v+=B:v+=B.slice(0,N),N-=I,N===0){I===B.length?(++x,p.next?this.head=p.next:this.head=this.tail=null):(this.head=p,p.data=B.slice(I));break}++x}return this.length-=x,v}},{key:"_getBuffer",value:function(N){var p=E.allocUnsafe(N),x=this.head,v=1;for(x.data.copy(p),N-=x.data.length;x=x.next;){var B=x.data,I=N>B.length?B.length:N;if(B.copy(p,p.length-N,0,I),N-=I,N===0){I===B.length?(++v,x.next?this.head=x.next:this.head=this.tail=null):(this.head=x,x.data=B.slice(I));break}++v}return this.length-=v,p}},{key:F,value:function(N,p){return y(this,e(e({},p),{},{depth:0,customInspect:!1}))}}]),O}(),tt}function bi(i,e){var n=this,s=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return s||c?(e?e(i):i&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(yt,this,i)):process.nextTick(yt,this,i)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(i||null,function(h){!e&&h?n._writableState?n._writableState.errorEmitted?process.nextTick(ze,n):(n._writableState.errorEmitted=!0,process.nextTick(Tt,n,h)):process.nextTick(Tt,n,h):e?(process.nextTick(ze,n),e(h)):process.nextTick(ze,n)}),this)}function Tt(i,e){yt(i,e),ze(i)}function ze(i){i._writableState&&!i._writableState.emitClose||i._readableState&&!i._readableState.emitClose||i.emit("close")}function Ei(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function yt(i,e){i.emit("error",e)}function vi(i,e){var n=i._readableState,s=i._writableState;n&&n.autoDestroy||s&&s.autoDestroy?i.destroy(e):i.emit("error",e)}var lr={destroy:bi,undestroy:Ei,errorOrDestroy:vi},Ae={};function Ri(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e}var cr={};function ge(i,e,n){n||(n=Error);function s(h,d,f){return typeof e=="string"?e:e(h,d,f)}var c=function(h){Ri(d,h);function d(f,R,E){return h.call(this,s(f,R,E))||this}return d}(n);c.prototype.name=n.name,c.prototype.code=i,cr[i]=c}function At(i,e){if(Array.isArray(i)){var n=i.length;return i=i.map(function(s){return String(s)}),n>2?"one of ".concat(e," ").concat(i.slice(0,n-1).join(", "),", or ")+i[n-1]:n===2?"one of ".concat(e," ").concat(i[0]," or ").concat(i[1]):"of ".concat(e," ").concat(i[0])}else return"of ".concat(e," ").concat(String(i))}function Ci(i,e,n){return i.substr(0,e.length)===e}function Si(i,e,n){return(n===void 0||n>i.length)&&(n=i.length),i.substring(n-e.length,n)===e}function xi(i,e,n){return typeof n!="number"&&(n=0),n+e.length>i.length?!1:i.indexOf(e,n)!==-1}ge("ERR_INVALID_OPT_VALUE",function(i,e){return'The value "'+e+'" is invalid for option "'+i+'"'},TypeError);ge("ERR_INVALID_ARG_TYPE",function(i,e,n){var s;typeof e=="string"&&Ci(e,"not ")?(s="must not be",e=e.replace(/^not /,"")):s="must be";var c;if(Si(i," argument"))c="The ".concat(i," ").concat(s," ").concat(At(e,"type"));else{var h=xi(i,".")?"property":"argument";c='The "'.concat(i,'" ').concat(h," ").concat(s," ").concat(At(e,"type"))}return c+=". Received type ".concat(typeof n),c},TypeError);ge("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");ge("ERR_METHOD_NOT_IMPLEMENTED",function(i){return"The "+i+" method is not implemented"});ge("ERR_STREAM_PREMATURE_CLOSE","Premature close");ge("ERR_STREAM_DESTROYED",function(i){return"Cannot call "+i+" after a stream was destroyed"});ge("ERR_MULTIPLE_CALLBACK","Callback called multiple times");ge("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");ge("ERR_STREAM_WRITE_AFTER_END","write after end");ge("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);ge("ERR_UNKNOWN_ENCODING",function(i){return"Unknown encoding: "+i},TypeError);ge("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");Ae.codes=cr;var Ti=Ae.codes.ERR_INVALID_OPT_VALUE;function Ai(i,e,n){return i.highWaterMark!=null?i.highWaterMark:e?i[n]:null}function Ni(i,e,n,s){var c=Ai(e,s,n);if(c!=null){if(!(isFinite(c)&&Math.floor(c)===c)||c<0){var h=s?n:"highWaterMark";throw new Ti(h,c)}return Math.floor(c)}return i.objectMode?16:16*1024}var ur={getHighWaterMark:Ni},mt={exports:{}};typeof Object.create=="function"?mt.exports=function(e,n){n&&(e.super_=n,e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:mt.exports=function(e,n){if(n){e.super_=n;var s=function(){};s.prototype=n.prototype,e.prototype=new s,e.prototype.constructor=e}};var We=mt.exports,Bi=Ii;function Ii(i,e){if(rt("noDeprecation"))return i;var n=!1;function s(){if(!n){if(rt("throwDeprecation"))throw new Error(e);rt("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return i.apply(this,arguments)}return s}function rt(i){try{if(!window.localStorage)return!1}catch{return!1}var e=window.localStorage[i];return e==null?!1:String(e).toLowerCase()==="true"}var nt,Nt;function fr(){if(Nt)return nt;Nt=1,nt=$;function i(w){var _=this;this.next=null,this.entry=null,this.finish=function(){Be(_,w)}}var e;$.WritableState=P;var n={deprecate:Bi},s=sr,c=ke.Buffer,h=(typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function d(w){return c.from(w)}function f(w){return c.isBuffer(w)||w instanceof h}var R=lr,E=ur,b=E.getHighWaterMark,y=Ae.codes,F=y.ERR_INVALID_ARG_TYPE,k=y.ERR_METHOD_NOT_IMPLEMENTED,O=y.ERR_MULTIPLE_CALLBACK,L=y.ERR_STREAM_CANNOT_PIPE,N=y.ERR_STREAM_DESTROYED,p=y.ERR_STREAM_NULL_VALUES,x=y.ERR_STREAM_WRITE_AFTER_END,v=y.ERR_UNKNOWN_ENCODING,B=R.errorOrDestroy;We($,s);function I(){}function P(w,_,A){e=e||je(),w=w||{},typeof A!="boolean"&&(A=_ instanceof e),this.objectMode=!!w.objectMode,A&&(this.objectMode=this.objectMode||!!w.writableObjectMode),this.highWaterMark=b(this,w,"writableHighWaterMark",A),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var D=w.decodeStrings===!1;this.decodeStrings=!D,this.defaultEncoding=w.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(V){Z(_,V)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=w.emitClose!==!1,this.autoDestroy=!!w.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}P.prototype.getBuffer=function(){for(var _=this.bufferedRequest,A=[];_;)A.push(_),_=_.next;return A},function(){try{Object.defineProperty(P.prototype,"buffer",{get:n.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var J;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(J=Function.prototype[Symbol.hasInstance],Object.defineProperty($,Symbol.hasInstance,{value:function(_){return J.call(this,_)?!0:this!==$?!1:_&&_._writableState instanceof P}})):J=function(_){return _ instanceof this};function $(w){e=e||je();var _=this instanceof e;if(!_&&!J.call($,this))return new $(w);this._writableState=new P(w,this,_),this.writable=!0,w&&(typeof w.write=="function"&&(this._write=w.write),typeof w.writev=="function"&&(this._writev=w.writev),typeof w.destroy=="function"&&(this._destroy=w.destroy),typeof w.final=="function"&&(this._final=w.final)),s.call(this)}$.prototype.pipe=function(){B(this,new L)};function q(w,_){var A=new x;B(w,A),process.nextTick(_,A)}function fe(w,_,A,D){var V;return A===null?V=new p:typeof A!="string"&&!_.objectMode&&(V=new F("chunk",["string","Buffer"],A)),V?(B(w,V),process.nextTick(D,V),!1):!0}$.prototype.write=function(w,_,A){var D=this._writableState,V=!1,l=!D.objectMode&&f(w);return l&&!c.isBuffer(w)&&(w=d(w)),typeof _=="function"&&(A=_,_=null),l?_="buffer":_||(_=D.defaultEncoding),typeof A!="function"&&(A=I),D.ending?q(this,A):(l||fe(this,D,w,A))&&(D.pendingcb++,V=be(this,D,l,w,_,A)),V},$.prototype.cork=function(){this._writableState.corked++},$.prototype.uncork=function(){var w=this._writableState;w.corked&&(w.corked--,!w.writing&&!w.corked&&!w.bufferProcessing&&w.bufferedRequest&&le(this,w))},$.prototype.setDefaultEncoding=function(_){if(typeof _=="string"&&(_=_.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((_+"").toLowerCase())>-1))throw new v(_);return this._writableState.defaultEncoding=_,this},Object.defineProperty($.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function me(w,_,A){return!w.objectMode&&w.decodeStrings!==!1&&typeof _=="string"&&(_=c.from(_,A)),_}Object.defineProperty($.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function be(w,_,A,D,V,l){if(!A){var u=me(_,D,V);D!==u&&(A=!0,V="buffer",D=u)}var T=_.objectMode?1:D.length;_.length+=T;var j=_.length<_.highWaterMark;if(j||(_.needDrain=!0),_.writing||_.corked){var re=_.lastBufferedRequest;_.lastBufferedRequest={chunk:D,encoding:V,isBuf:A,callback:l,next:null},re?re.next=_.lastBufferedRequest:_.bufferedRequest=_.lastBufferedRequest,_.bufferedRequestCount+=1}else M(w,_,!1,T,D,V,l);return j}function M(w,_,A,D,V,l,u){_.writelen=D,_.writecb=u,_.writing=!0,_.sync=!0,_.destroyed?_.onwrite(new N("write")):A?w._writev(V,_.onwrite):w._write(V,l,_.onwrite),_.sync=!1}function oe(w,_,A,D,V){--_.pendingcb,A?(process.nextTick(V,D),process.nextTick(_e,w,_),w._writableState.errorEmitted=!0,B(w,D)):(V(D),w._writableState.errorEmitted=!0,B(w,D),_e(w,_))}function ue(w){w.writing=!1,w.writecb=null,w.length-=w.writelen,w.writelen=0}function Z(w,_){var A=w._writableState,D=A.sync,V=A.writecb;if(typeof V!="function")throw new O;if(ue(A),_)oe(w,A,D,_,V);else{var l=Ee(A)||w.destroyed;!l&&!A.corked&&!A.bufferProcessing&&A.bufferedRequest&&le(w,A),D?process.nextTick(W,w,A,l,V):W(w,A,l,V)}}function W(w,_,A,D){A||ee(w,_),_.pendingcb--,D(),_e(w,_)}function ee(w,_){_.length===0&&_.needDrain&&(_.needDrain=!1,w.emit("drain"))}function le(w,_){_.bufferProcessing=!0;var A=_.bufferedRequest;if(w._writev&&A&&A.next){var D=_.bufferedRequestCount,V=new Array(D),l=_.corkedRequestsFree;l.entry=A;for(var u=0,T=!0;A;)V[u]=A,A.isBuf||(T=!1),A=A.next,u+=1;V.allBuffers=T,M(w,_,!0,_.length,V,"",l.finish),_.pendingcb++,_.lastBufferedRequest=null,l.next?(_.corkedRequestsFree=l.next,l.next=null):_.corkedRequestsFree=new i(_),_.bufferedRequestCount=0}else{for(;A;){var j=A.chunk,re=A.encoding,z=A.callback,K=_.objectMode?1:j.length;if(M(w,_,!1,K,j,re,z),A=A.next,_.bufferedRequestCount--,_.writing)break}A===null&&(_.lastBufferedRequest=null)}_.bufferedRequest=A,_.bufferProcessing=!1}$.prototype._write=function(w,_,A){A(new k("_write()"))},$.prototype._writev=null,$.prototype.end=function(w,_,A){var D=this._writableState;return typeof w=="function"?(A=w,w=null,_=null):typeof _=="function"&&(A=_,_=null),w!=null&&this.write(w,_),D.corked&&(D.corked=1,this.uncork()),D.ending||Ne(this,D,A),this},Object.defineProperty($.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Ee(w){return w.ending&&w.length===0&&w.bufferedRequest===null&&!w.finished&&!w.writing}function te(w,_){w._final(function(A){_.pendingcb--,A&&B(w,A),_.prefinished=!0,w.emit("prefinish"),_e(w,_)})}function ce(w,_){!_.prefinished&&!_.finalCalled&&(typeof w._final=="function"&&!_.destroyed?(_.pendingcb++,_.finalCalled=!0,process.nextTick(te,w,_)):(_.prefinished=!0,w.emit("prefinish")))}function _e(w,_){var A=Ee(_);if(A&&(ce(w,_),_.pendingcb===0&&(_.finished=!0,w.emit("finish"),_.autoDestroy))){var D=w._readableState;(!D||D.autoDestroy&&D.endEmitted)&&w.destroy()}return A}function Ne(w,_,A){_.ending=!0,_e(w,_),A&&(_.finished?process.nextTick(A):w.once("finish",A)),_.ended=!0,w.writable=!1}function Be(w,_,A){var D=w.entry;for(w.entry=null;D;){var V=D.callback;_.pendingcb--,V(A),D=D.next}_.corkedRequestsFree.next=w}return Object.defineProperty($.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(_){this._writableState&&(this._writableState.destroyed=_)}}),$.prototype.destroy=R.destroy,$.prototype._undestroy=R.undestroy,$.prototype._destroy=function(w,_){_(w)},nt}var it,Bt;function je(){if(Bt)return it;Bt=1;var i=Object.keys||function(E){var b=[];for(var y in E)b.push(y);return b};it=d;var e=dr(),n=fr();We(d,e);for(var s=i(n.prototype),c=0;c<s.length;c++){var h=s[c];d.prototype[h]||(d.prototype[h]=n.prototype[h])}function d(E){if(!(this instanceof d))return new d(E);e.call(this,E),n.call(this,E),this.allowHalfOpen=!0,E&&(E.readable===!1&&(this.readable=!1),E.writable===!1&&(this.writable=!1),E.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",f)))}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(d.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function f(){this._writableState.ended||process.nextTick(R,this)}function R(E){E.end()}return Object.defineProperty(d.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(b){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=b,this._writableState.destroyed=b)}}),it}var ot={},It;function Ft(){if(It)return ot;It=1;var i=Jt.Buffer,e=i.isEncoding||function(p){switch(p=""+p,p&&p.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(p){if(!p)return"utf8";for(var x;;)switch(p){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return p;default:if(x)return;p=(""+p).toLowerCase(),x=!0}}function s(p){var x=n(p);if(typeof x!="string"&&(i.isEncoding===e||!e(p)))throw new Error("Unknown encoding: "+p);return x||p}ot.StringDecoder=c;function c(p){this.encoding=s(p);var x;switch(this.encoding){case"utf16le":this.text=y,this.end=F,x=4;break;case"utf8":this.fillLast=R,x=4;break;case"base64":this.text=k,this.end=O,x=3;break;default:this.write=L,this.end=N;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(x)}c.prototype.write=function(p){if(p.length===0)return"";var x,v;if(this.lastNeed){if(x=this.fillLast(p),x===void 0)return"";v=this.lastNeed,this.lastNeed=0}else v=0;return v<p.length?x?x+this.text(p,v):this.text(p,v):x||""},c.prototype.end=b,c.prototype.text=E,c.prototype.fillLast=function(p){if(this.lastNeed<=p.length)return p.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);p.copy(this.lastChar,this.lastTotal-this.lastNeed,0,p.length),this.lastNeed-=p.length};function h(p){return p<=127?0:p>>5===6?2:p>>4===14?3:p>>3===30?4:p>>6===2?-1:-2}function d(p,x,v){var B=x.length-1;if(B<v)return 0;var I=h(x[B]);return I>=0?(I>0&&(p.lastNeed=I-1),I):--B<v||I===-2?0:(I=h(x[B]),I>=0?(I>0&&(p.lastNeed=I-2),I):--B<v||I===-2?0:(I=h(x[B]),I>=0?(I>0&&(I===2?I=0:p.lastNeed=I-3),I):0))}function f(p,x,v){if((x[0]&192)!==128)return p.lastNeed=0,"�";if(p.lastNeed>1&&x.length>1){if((x[1]&192)!==128)return p.lastNeed=1,"�";if(p.lastNeed>2&&x.length>2&&(x[2]&192)!==128)return p.lastNeed=2,"�"}}function R(p){var x=this.lastTotal-this.lastNeed,v=f(this,p);if(v!==void 0)return v;if(this.lastNeed<=p.length)return p.copy(this.lastChar,x,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);p.copy(this.lastChar,x,0,p.length),this.lastNeed-=p.length}function E(p,x){var v=d(this,p,x);if(!this.lastNeed)return p.toString("utf8",x);this.lastTotal=v;var B=p.length-(v-this.lastNeed);return p.copy(this.lastChar,0,B),p.toString("utf8",x,B)}function b(p){var x=p&&p.length?this.write(p):"";return this.lastNeed?x+"�":x}function y(p,x){if((p.length-x)%2===0){var v=p.toString("utf16le",x);if(v){var B=v.charCodeAt(v.length-1);if(B>=55296&&B<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=p[p.length-2],this.lastChar[1]=p[p.length-1],v.slice(0,-1)}return v}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=p[p.length-1],p.toString("utf16le",x,p.length-1)}function F(p){var x=p&&p.length?this.write(p):"";if(this.lastNeed){var v=this.lastTotal-this.lastNeed;return x+this.lastChar.toString("utf16le",0,v)}return x}function k(p,x){var v=(p.length-x)%3;return v===0?p.toString("base64",x):(this.lastNeed=3-v,this.lastTotal=3,v===1?this.lastChar[0]=p[p.length-1]:(this.lastChar[0]=p[p.length-2],this.lastChar[1]=p[p.length-1]),p.toString("base64",x,p.length-v))}function O(p){var x=p&&p.length?this.write(p):"";return this.lastNeed?x+this.lastChar.toString("base64",0,3-this.lastNeed):x}function L(p){return p.toString(this.encoding)}function N(p){return p&&p.length?this.write(p):""}return ot}var Ot=Ae.codes.ERR_STREAM_PREMATURE_CLOSE;function Fi(i){var e=!1;return function(){if(!e){e=!0;for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];i.apply(this,s)}}}function Oi(){}function Li(i){return i.setHeader&&typeof i.abort=="function"}function hr(i,e,n){if(typeof e=="function")return hr(i,null,e);e||(e={}),n=Fi(n||Oi);var s=e.readable||e.readable!==!1&&i.readable,c=e.writable||e.writable!==!1&&i.writable,h=function(){i.writable||f()},d=i._writableState&&i._writableState.finished,f=function(){c=!1,d=!0,s||n.call(i)},R=i._readableState&&i._readableState.endEmitted,E=function(){s=!1,R=!0,c||n.call(i)},b=function(O){n.call(i,O)},y=function(){var O;if(s&&!R)return(!i._readableState||!i._readableState.ended)&&(O=new Ot),n.call(i,O);if(c&&!d)return(!i._writableState||!i._writableState.ended)&&(O=new Ot),n.call(i,O)},F=function(){i.req.on("finish",f)};return Li(i)?(i.on("complete",f),i.on("abort",y),i.req?F():i.on("request",F)):c&&!i._writableState&&(i.on("end",h),i.on("close",h)),i.on("end",E),i.on("finish",f),e.error!==!1&&i.on("error",b),i.on("close",y),function(){i.removeListener("complete",f),i.removeListener("abort",y),i.removeListener("request",F),i.req&&i.req.removeListener("finish",f),i.removeListener("end",h),i.removeListener("close",h),i.removeListener("finish",f),i.removeListener("end",E),i.removeListener("error",b),i.removeListener("close",y)}}var Et=hr,st,Lt;function ji(){if(Lt)return st;Lt=1;var i;function e(v,B,I){return B=n(B),B in v?Object.defineProperty(v,B,{value:I,enumerable:!0,configurable:!0,writable:!0}):v[B]=I,v}function n(v){var B=s(v,"string");return typeof B=="symbol"?B:String(B)}function s(v,B){if(typeof v!="object"||v===null)return v;var I=v[Symbol.toPrimitive];if(I!==void 0){var P=I.call(v,B);if(typeof P!="object")return P;throw new TypeError("@@toPrimitive must return a primitive value.")}return(B==="string"?String:Number)(v)}var c=Et,h=Symbol("lastResolve"),d=Symbol("lastReject"),f=Symbol("error"),R=Symbol("ended"),E=Symbol("lastPromise"),b=Symbol("handlePromise"),y=Symbol("stream");function F(v,B){return{value:v,done:B}}function k(v){var B=v[h];if(B!==null){var I=v[y].read();I!==null&&(v[E]=null,v[h]=null,v[d]=null,B(F(I,!1)))}}function O(v){process.nextTick(k,v)}function L(v,B){return function(I,P){v.then(function(){if(B[R]){I(F(void 0,!0));return}B[b](I,P)},P)}}var N=Object.getPrototypeOf(function(){}),p=Object.setPrototypeOf((i={get stream(){return this[y]},next:function(){var B=this,I=this[f];if(I!==null)return Promise.reject(I);if(this[R])return Promise.resolve(F(void 0,!0));if(this[y].destroyed)return new Promise(function(q,fe){process.nextTick(function(){B[f]?fe(B[f]):q(F(void 0,!0))})});var P=this[E],J;if(P)J=new Promise(L(P,this));else{var $=this[y].read();if($!==null)return Promise.resolve(F($,!1));J=new Promise(this[b])}return this[E]=J,J}},e(i,Symbol.asyncIterator,function(){return this}),e(i,"return",function(){var B=this;return new Promise(function(I,P){B[y].destroy(null,function(J){if(J){P(J);return}I(F(void 0,!0))})})}),i),N),x=function(B){var I,P=Object.create(p,(I={},e(I,y,{value:B,writable:!0}),e(I,h,{value:null,writable:!0}),e(I,d,{value:null,writable:!0}),e(I,f,{value:null,writable:!0}),e(I,R,{value:B._readableState.endEmitted,writable:!0}),e(I,b,{value:function($,q){var fe=P[y].read();fe?(P[E]=null,P[h]=null,P[d]=null,$(F(fe,!1))):(P[h]=$,P[d]=q)},writable:!0}),I));return P[E]=null,c(B,function(J){if(J&&J.code!=="ERR_STREAM_PREMATURE_CLOSE"){var $=P[d];$!==null&&(P[E]=null,P[h]=null,P[d]=null,$(J)),P[f]=J;return}var q=P[h];q!==null&&(P[E]=null,P[h]=null,P[d]=null,q(F(void 0,!0))),P[R]=!0}),B.on("readable",O.bind(null,P)),P};return st=x,st}var at,jt;function ki(){return jt||(jt=1,at=function(){throw new Error("Readable.from is not available in the browser")}),at}var lt,kt;function dr(){if(kt)return lt;kt=1,lt=q;var i;q.ReadableState=$,or.EventEmitter;var e=function(u,T){return u.listeners(T).length},n=sr,s=ke.Buffer,c=(typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function h(l){return s.from(l)}function d(l){return s.isBuffer(l)||l instanceof c}var f=ar,R;f&&f.debuglog?R=f.debuglog("stream"):R=function(){};var E=wi(),b=lr,y=ur,F=y.getHighWaterMark,k=Ae.codes,O=k.ERR_INVALID_ARG_TYPE,L=k.ERR_STREAM_PUSH_AFTER_EOF,N=k.ERR_METHOD_NOT_IMPLEMENTED,p=k.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,x,v,B;We(q,n);var I=b.errorOrDestroy,P=["error","close","destroy","pause","resume"];function J(l,u,T){if(typeof l.prependListener=="function")return l.prependListener(u,T);!l._events||!l._events[u]?l.on(u,T):Array.isArray(l._events[u])?l._events[u].unshift(T):l._events[u]=[T,l._events[u]]}function $(l,u,T){i=i||je(),l=l||{},typeof T!="boolean"&&(T=u instanceof i),this.objectMode=!!l.objectMode,T&&(this.objectMode=this.objectMode||!!l.readableObjectMode),this.highWaterMark=F(this,l,"readableHighWaterMark",T),this.buffer=new E,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=l.emitClose!==!1,this.autoDestroy=!!l.autoDestroy,this.destroyed=!1,this.defaultEncoding=l.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,l.encoding&&(x||(x=Ft().StringDecoder),this.decoder=new x(l.encoding),this.encoding=l.encoding)}function q(l){if(i=i||je(),!(this instanceof q))return new q(l);var u=this instanceof i;this._readableState=new $(l,this,u),this.readable=!0,l&&(typeof l.read=="function"&&(this._read=l.read),typeof l.destroy=="function"&&(this._destroy=l.destroy)),n.call(this)}Object.defineProperty(q.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(u){this._readableState&&(this._readableState.destroyed=u)}}),q.prototype.destroy=b.destroy,q.prototype._undestroy=b.undestroy,q.prototype._destroy=function(l,u){u(l)},q.prototype.push=function(l,u){var T=this._readableState,j;return T.objectMode?j=!0:typeof l=="string"&&(u=u||T.defaultEncoding,u!==T.encoding&&(l=s.from(l,u),u=""),j=!0),fe(this,l,u,!1,j)},q.prototype.unshift=function(l){return fe(this,l,null,!0,!1)};function fe(l,u,T,j,re){R("readableAddChunk",u);var z=l._readableState;if(u===null)z.reading=!1,Z(l,z);else{var K;if(re||(K=be(z,u)),K)I(l,K);else if(z.objectMode||u&&u.length>0)if(typeof u!="string"&&!z.objectMode&&Object.getPrototypeOf(u)!==s.prototype&&(u=h(u)),j)z.endEmitted?I(l,new p):me(l,z,u,!0);else if(z.ended)I(l,new L);else{if(z.destroyed)return!1;z.reading=!1,z.decoder&&!T?(u=z.decoder.write(u),z.objectMode||u.length!==0?me(l,z,u,!1):le(l,z)):me(l,z,u,!1)}else j||(z.reading=!1,le(l,z))}return!z.ended&&(z.length<z.highWaterMark||z.length===0)}function me(l,u,T,j){u.flowing&&u.length===0&&!u.sync?(u.awaitDrain=0,l.emit("data",T)):(u.length+=u.objectMode?1:T.length,j?u.buffer.unshift(T):u.buffer.push(T),u.needReadable&&W(l)),le(l,u)}function be(l,u){var T;return!d(u)&&typeof u!="string"&&u!==void 0&&!l.objectMode&&(T=new O("chunk",["string","Buffer","Uint8Array"],u)),T}q.prototype.isPaused=function(){return this._readableState.flowing===!1},q.prototype.setEncoding=function(l){x||(x=Ft().StringDecoder);var u=new x(l);this._readableState.decoder=u,this._readableState.encoding=this._readableState.decoder.encoding;for(var T=this._readableState.buffer.head,j="";T!==null;)j+=u.write(T.data),T=T.next;return this._readableState.buffer.clear(),j!==""&&this._readableState.buffer.push(j),this._readableState.length=j.length,this};var M=1073741824;function oe(l){return l>=M?l=M:(l--,l|=l>>>1,l|=l>>>2,l|=l>>>4,l|=l>>>8,l|=l>>>16,l++),l}function ue(l,u){return l<=0||u.length===0&&u.ended?0:u.objectMode?1:l!==l?u.flowing&&u.length?u.buffer.head.data.length:u.length:(l>u.highWaterMark&&(u.highWaterMark=oe(l)),l<=u.length?l:u.ended?u.length:(u.needReadable=!0,0))}q.prototype.read=function(l){R("read",l),l=parseInt(l,10);var u=this._readableState,T=l;if(l!==0&&(u.emittedReadable=!1),l===0&&u.needReadable&&((u.highWaterMark!==0?u.length>=u.highWaterMark:u.length>0)||u.ended))return R("read: emitReadable",u.length,u.ended),u.length===0&&u.ended?A(this):W(this),null;if(l=ue(l,u),l===0&&u.ended)return u.length===0&&A(this),null;var j=u.needReadable;R("need readable",j),(u.length===0||u.length-l<u.highWaterMark)&&(j=!0,R("length less than watermark",j)),u.ended||u.reading?(j=!1,R("reading or ended",j)):j&&(R("do read"),u.reading=!0,u.sync=!0,u.length===0&&(u.needReadable=!0),this._read(u.highWaterMark),u.sync=!1,u.reading||(l=ue(T,u)));var re;return l>0?re=_(l,u):re=null,re===null?(u.needReadable=u.length<=u.highWaterMark,l=0):(u.length-=l,u.awaitDrain=0),u.length===0&&(u.ended||(u.needReadable=!0),T!==l&&u.ended&&A(this)),re!==null&&this.emit("data",re),re};function Z(l,u){if(R("onEofChunk"),!u.ended){if(u.decoder){var T=u.decoder.end();T&&T.length&&(u.buffer.push(T),u.length+=u.objectMode?1:T.length)}u.ended=!0,u.sync?W(l):(u.needReadable=!1,u.emittedReadable||(u.emittedReadable=!0,ee(l)))}}function W(l){var u=l._readableState;R("emitReadable",u.needReadable,u.emittedReadable),u.needReadable=!1,u.emittedReadable||(R("emitReadable",u.flowing),u.emittedReadable=!0,process.nextTick(ee,l))}function ee(l){var u=l._readableState;R("emitReadable_",u.destroyed,u.length,u.ended),!u.destroyed&&(u.length||u.ended)&&(l.emit("readable"),u.emittedReadable=!1),u.needReadable=!u.flowing&&!u.ended&&u.length<=u.highWaterMark,w(l)}function le(l,u){u.readingMore||(u.readingMore=!0,process.nextTick(Ee,l,u))}function Ee(l,u){for(;!u.reading&&!u.ended&&(u.length<u.highWaterMark||u.flowing&&u.length===0);){var T=u.length;if(R("maybeReadMore read 0"),l.read(0),T===u.length)break}u.readingMore=!1}q.prototype._read=function(l){I(this,new N("_read()"))},q.prototype.pipe=function(l,u){var T=this,j=this._readableState;switch(j.pipesCount){case 0:j.pipes=l;break;case 1:j.pipes=[j.pipes,l];break;default:j.pipes.push(l);break}j.pipesCount+=1,R("pipe count=%d opts=%j",j.pipesCount,u);var re=(!u||u.end!==!1)&&l!==process.stdout&&l!==process.stderr,z=re?ve:Se;j.endEmitted?process.nextTick(z):T.once("end",z),l.on("unpipe",K);function K(o,t){R("onunpipe"),o===T&&t&&t.hasUnpiped===!1&&(t.hasUnpiped=!0,Fe())}function ve(){R("onend"),l.end()}var Ie=te(T);l.on("drain",Ie);var Pe=!1;function Fe(){R("cleanup"),l.removeListener("close",Me),l.removeListener("finish",de),l.removeListener("drain",Ie),l.removeListener("error",Ce),l.removeListener("unpipe",K),T.removeListener("end",ve),T.removeListener("end",Se),T.removeListener("data",he),Pe=!0,j.awaitDrain&&(!l._writableState||l._writableState.needDrain)&&Ie()}T.on("data",he);function he(o){R("ondata");var t=l.write(o);R("dest.write",t),t===!1&&((j.pipesCount===1&&j.pipes===l||j.pipesCount>1&&V(j.pipes,l)!==-1)&&!Pe&&(R("false write response, pause",j.awaitDrain),j.awaitDrain++),T.pause())}function Ce(o){R("onerror",o),Se(),l.removeListener("error",Ce),e(l,"error")===0&&I(l,o)}J(l,"error",Ce);function Me(){l.removeListener("finish",de),Se()}l.once("close",Me);function de(){R("onfinish"),l.removeListener("close",Me),Se()}l.once("finish",de);function Se(){R("unpipe"),T.unpipe(l)}return l.emit("pipe",T),j.flowing||(R("pipe resume"),T.resume()),l};function te(l){return function(){var T=l._readableState;R("pipeOnDrain",T.awaitDrain),T.awaitDrain&&T.awaitDrain--,T.awaitDrain===0&&e(l,"data")&&(T.flowing=!0,w(l))}}q.prototype.unpipe=function(l){var u=this._readableState,T={hasUnpiped:!1};if(u.pipesCount===0)return this;if(u.pipesCount===1)return l&&l!==u.pipes?this:(l||(l=u.pipes),u.pipes=null,u.pipesCount=0,u.flowing=!1,l&&l.emit("unpipe",this,T),this);if(!l){var j=u.pipes,re=u.pipesCount;u.pipes=null,u.pipesCount=0,u.flowing=!1;for(var z=0;z<re;z++)j[z].emit("unpipe",this,{hasUnpiped:!1});return this}var K=V(u.pipes,l);return K===-1?this:(u.pipes.splice(K,1),u.pipesCount-=1,u.pipesCount===1&&(u.pipes=u.pipes[0]),l.emit("unpipe",this,T),this)},q.prototype.on=function(l,u){var T=n.prototype.on.call(this,l,u),j=this._readableState;return l==="data"?(j.readableListening=this.listenerCount("readable")>0,j.flowing!==!1&&this.resume()):l==="readable"&&!j.endEmitted&&!j.readableListening&&(j.readableListening=j.needReadable=!0,j.flowing=!1,j.emittedReadable=!1,R("on readable",j.length,j.reading),j.length?W(this):j.reading||process.nextTick(_e,this)),T},q.prototype.addListener=q.prototype.on,q.prototype.removeListener=function(l,u){var T=n.prototype.removeListener.call(this,l,u);return l==="readable"&&process.nextTick(ce,this),T},q.prototype.removeAllListeners=function(l){var u=n.prototype.removeAllListeners.apply(this,arguments);return(l==="readable"||l===void 0)&&process.nextTick(ce,this),u};function ce(l){var u=l._readableState;u.readableListening=l.listenerCount("readable")>0,u.resumeScheduled&&!u.paused?u.flowing=!0:l.listenerCount("data")>0&&l.resume()}function _e(l){R("readable nexttick read 0"),l.read(0)}q.prototype.resume=function(){var l=this._readableState;return l.flowing||(R("resume"),l.flowing=!l.readableListening,Ne(this,l)),l.paused=!1,this};function Ne(l,u){u.resumeScheduled||(u.resumeScheduled=!0,process.nextTick(Be,l,u))}function Be(l,u){R("resume",u.reading),u.reading||l.read(0),u.resumeScheduled=!1,l.emit("resume"),w(l),u.flowing&&!u.reading&&l.read(0)}q.prototype.pause=function(){return R("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(R("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function w(l){var u=l._readableState;for(R("flow",u.flowing);u.flowing&&l.read()!==null;);}q.prototype.wrap=function(l){var u=this,T=this._readableState,j=!1;l.on("end",function(){if(R("wrapped end"),T.decoder&&!T.ended){var K=T.decoder.end();K&&K.length&&u.push(K)}u.push(null)}),l.on("data",function(K){if(R("wrapped data"),T.decoder&&(K=T.decoder.write(K)),!(T.objectMode&&K==null)&&!(!T.objectMode&&(!K||!K.length))){var ve=u.push(K);ve||(j=!0,l.pause())}});for(var re in l)this[re]===void 0&&typeof l[re]=="function"&&(this[re]=function(ve){return function(){return l[ve].apply(l,arguments)}}(re));for(var z=0;z<P.length;z++)l.on(P[z],this.emit.bind(this,P[z]));return this._read=function(K){R("wrapped _read",K),j&&(j=!1,l.resume())},this},typeof Symbol=="function"&&(q.prototype[Symbol.asyncIterator]=function(){return v===void 0&&(v=ji()),v(this)}),Object.defineProperty(q.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(q.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(q.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(u){this._readableState&&(this._readableState.flowing=u)}}),q._fromList=_,Object.defineProperty(q.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function _(l,u){if(u.length===0)return null;var T;return u.objectMode?T=u.buffer.shift():!l||l>=u.length?(u.decoder?T=u.buffer.join(""):u.buffer.length===1?T=u.buffer.first():T=u.buffer.concat(u.length),u.buffer.clear()):T=u.buffer.consume(l,u.decoder),T}function A(l){var u=l._readableState;R("endReadable",u.endEmitted),u.endEmitted||(u.ended=!0,process.nextTick(D,u,l))}function D(l,u){if(R("endReadableNT",l.endEmitted,l.length),!l.endEmitted&&l.length===0&&(l.endEmitted=!0,u.readable=!1,u.emit("end"),l.autoDestroy)){var T=u._writableState;(!T||T.autoDestroy&&T.finished)&&u.destroy()}}typeof Symbol=="function"&&(q.from=function(l,u){return B===void 0&&(B=ki()),B(q,l,u)});function V(l,u){for(var T=0,j=l.length;T<j;T++)if(l[T]===u)return T;return-1}return lt}var pr=we,Je=Ae.codes,Pi=Je.ERR_METHOD_NOT_IMPLEMENTED,Mi=Je.ERR_MULTIPLE_CALLBACK,Di=Je.ERR_TRANSFORM_ALREADY_TRANSFORMING,Ui=Je.ERR_TRANSFORM_WITH_LENGTH_0,Xe=je();We(we,Xe);function qi(i,e){var n=this._transformState;n.transforming=!1;var s=n.writecb;if(s===null)return this.emit("error",new Mi);n.writechunk=null,n.writecb=null,e!=null&&this.push(e),s(i);var c=this._readableState;c.reading=!1,(c.needReadable||c.length<c.highWaterMark)&&this._read(c.highWaterMark)}function we(i){if(!(this instanceof we))return new we(i);Xe.call(this,i),this._transformState={afterTransform:qi.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,i&&(typeof i.transform=="function"&&(this._transform=i.transform),typeof i.flush=="function"&&(this._flush=i.flush)),this.on("prefinish",$i)}function $i(){var i=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,n){Pt(i,e,n)}):Pt(this,null,null)}we.prototype.push=function(i,e){return this._transformState.needTransform=!1,Xe.prototype.push.call(this,i,e)};we.prototype._transform=function(i,e,n){n(new Pi("_transform()"))};we.prototype._write=function(i,e,n){var s=this._transformState;if(s.writecb=n,s.writechunk=i,s.writeencoding=e,!s.transforming){var c=this._readableState;(s.needTransform||c.needReadable||c.length<c.highWaterMark)&&this._read(c.highWaterMark)}};we.prototype._read=function(i){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};we.prototype._destroy=function(i,e){Xe.prototype._destroy.call(this,i,function(n){e(n)})};function Pt(i,e,n){if(e)return i.emit("error",e);if(n!=null&&i.push(n),i._writableState.length)throw new Ui;if(i._transformState.transforming)throw new Di;return i.push(null)}var Wi=$e,gr=pr;We($e,gr);function $e(i){if(!(this instanceof $e))return new $e(i);gr.call(this,i)}$e.prototype._transform=function(i,e,n){n(null,i)};var ct;function Vi(i){var e=!1;return function(){e||(e=!0,i.apply(void 0,arguments))}}var _r=Ae.codes,zi=_r.ERR_MISSING_ARGS,Hi=_r.ERR_STREAM_DESTROYED;function Mt(i){if(i)throw i}function Gi(i){return i.setHeader&&typeof i.abort=="function"}function Yi(i,e,n,s){s=Vi(s);var c=!1;i.on("close",function(){c=!0}),ct===void 0&&(ct=Et),ct(i,{readable:e,writable:n},function(d){if(d)return s(d);c=!0,s()});var h=!1;return function(d){if(!c&&!h){if(h=!0,Gi(i))return i.abort();if(typeof i.destroy=="function")return i.destroy();s(d||new Hi("pipe"))}}}function Dt(i){i()}function Ki(i,e){return i.pipe(e)}function Ji(i){return!i.length||typeof i[i.length-1]!="function"?Mt:i.pop()}function Xi(){for(var i=arguments.length,e=new Array(i),n=0;n<i;n++)e[n]=arguments[n];var s=Ji(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new zi("streams");var c,h=e.map(function(d,f){var R=f<e.length-1,E=f>0;return Yi(d,R,E,function(b){c||(c=b),b&&h.forEach(Dt),!R&&(h.forEach(Dt),s(c))})});return e.reduce(Ki)}var Qi=Xi;(function(i,e){e=i.exports=dr(),e.Stream=e,e.Readable=e,e.Writable=fr(),e.Duplex=je(),e.Transform=pr,e.PassThrough=Wi,e.finished=Et,e.pipeline=Qi})(_t,_t.exports);var Zi=_t.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Ut;var eo=typeof queueMicrotask=="function"?queueMicrotask.bind(window):i=>(Ut||(Ut=Promise.resolve())).then(i).catch(e=>setTimeout(()=>{throw e},0));function qt(i,e){for(const n in e)Object.defineProperty(i,n,{value:e[n],enumerable:!0,configurable:!0});return i}function to(i,e,n){if(!i||typeof i=="string")throw new TypeError("Please pass an Error to err-code");n||(n={}),typeof e=="object"&&(n=e,e=""),e&&(n.code=e);try{return qt(i,n)}catch{n.message=i.message,n.stack=i.stack;const c=function(){};return c.prototype=Object.create(Object.getPrototypeOf(i)),qt(new c,n)}}var ro=to;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const no=Jn("simple-peer"),yr=Xn,$t=ui,io=Zi,ut=eo,G=ro,{Buffer:oo}=ke,ft=64*1024,so=5*1e3,ao=5*1e3;function Wt(i){return i.replace(/a=ice-options:trickle\s\n/g,"")}function lo(i){console.warn(i)}class Te extends io.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=$t(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||$t(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Te.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Te.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(n=>n),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||so,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:yr(),!this._wrtc)throw G(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(n){this.destroy(G(n,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=n=>{this._onIceCandidate(n)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(n=>{this.destroy(G(n,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=n=>{this._setupData(n)},this.streams&&this.streams.forEach(n=>{this.addStream(n)}),this._pc.ontrack=n=>{this._onTrack(n)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw G(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(n=>{this._addIceCandidate(n)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(n=>{this.destroy(G(n,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(G(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const n=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(n).catch(s=>{!n.address||n.address.endsWith(".local")?lo("Ignoring unsupported ICE candidate."):this.destroy(G(s,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw G(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,n){if(!this.destroying){if(this.destroyed)throw G(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,n),this._needsNegotiation()}catch(s){this.destroy(G(s,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:n}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw G(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(n=>{this.addTrack(n,e)})}}addTrack(e,n){if(this.destroying)return;if(this.destroyed)throw G(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const s=this._senderMap.get(e)||new Map;let c=s.get(n);if(!c)c=this._pc.addTrack(e,n),s.set(n,c),this._senderMap.set(e,s),this._needsNegotiation();else throw c.removed?G(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):G(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,n,s){if(this.destroying)return;if(this.destroyed)throw G(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const c=this._senderMap.get(e),h=c?c.get(s):null;if(!h)throw G(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");n&&this._senderMap.set(n,c),h.replaceTrack!=null?h.replaceTrack(n):this.destroy(G(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,n){if(this.destroying)return;if(this.destroyed)throw G(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const s=this._senderMap.get(e),c=s?s.get(n):null;if(!c)throw G(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{c.removed=!0,this._pc.removeTrack(c)}catch(h){h.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(c):this.destroy(G(h,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw G(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(n=>{this.removeTrack(n,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,ut(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw G(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,n){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),ut(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),n()}))}_setupData(e){if(!e.channel)return this.destroy(G(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=ft),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{const c=s.error instanceof Error?s.error:new Error(`Datachannel error: ${s.message} ${s.filename}:${s.lineno}:${s.colno}`);this.destroy(G(c,"ERR_DATA_CHANNEL"))};let n=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(n&&this._onChannelClose(),n=!0):n=!1},ao)}_read(){}_write(e,n,s){if(this.destroyed)return s(G(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(c){return this.destroy(G(c,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>ft?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=s):s(null)}else this._debug("write before connect"),this._chunk=e,this._cb=s}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Wt(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const n=()=>{if(this.destroyed)return;const h=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:h.type,sdp:h.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},c=h=>{this.destroy(G(h,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(c)}).catch(e=>{this.destroy(G(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Wt(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const n=()=>{if(this.destroyed)return;const h=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:h.type,sdp:h.sdp}),this.initiator||this._requestMissingTransceivers()},s=()=>{this.destroyed||(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},c=h=>{this.destroy(G(h,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(c)}).catch(e=>{this.destroy(G(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(G(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,n=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,n),this.emit("iceStateChange",e,n),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(G(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(G(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const n=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(c=>{Object.assign(s,c)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{const c=[];s.forEach(h=>{c.push(n(h))}),e(null,c)},s=>e(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;const c=[];s.result().forEach(h=>{const d={};h.names().forEach(f=>{d[f]=h.stat(f)}),d.id=h.id,d.type=h.type,d.timestamp=h.timestamp,c.push(n(d))}),e(null,c)},s=>e(s)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((n,s)=>{if(this.destroyed)return;n&&(s=[]);const c={},h={},d={};let f=!1;s.forEach(E=>{(E.type==="remotecandidate"||E.type==="remote-candidate")&&(c[E.id]=E),(E.type==="localcandidate"||E.type==="local-candidate")&&(h[E.id]=E),(E.type==="candidatepair"||E.type==="candidate-pair")&&(d[E.id]=E)});const R=E=>{f=!0;let b=h[E.localCandidateId];b&&(b.ip||b.address)?(this.localAddress=b.ip||b.address,this.localPort=Number(b.port)):b&&b.ipAddress?(this.localAddress=b.ipAddress,this.localPort=Number(b.portNumber)):typeof E.googLocalAddress=="string"&&(b=E.googLocalAddress.split(":"),this.localAddress=b[0],this.localPort=Number(b[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let y=c[E.remoteCandidateId];y&&(y.ip||y.address)?(this.remoteAddress=y.ip||y.address,this.remotePort=Number(y.port)):y&&y.ipAddress?(this.remoteAddress=y.ipAddress,this.remotePort=Number(y.portNumber)):typeof E.googRemoteAddress=="string"&&(y=E.googRemoteAddress.split(":"),this.remoteAddress=y[0],this.remotePort=Number(y[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(E=>{E.type==="transport"&&E.selectedCandidatePairId&&R(d[E.selectedCandidatePairId]),(E.type==="googCandidatePair"&&E.googActiveConnection==="true"||(E.type==="candidatepair"||E.type==="candidate-pair")&&E.selected)&&R(E)}),!f&&(!Object.keys(d).length||Object.keys(h).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(b){return this.destroy(G(b,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const E=this._cb;this._cb=null,E(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>ft||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let n=e.data;n instanceof ArrayBuffer&&(n=oo.from(n)),this.push(n)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(n=>{this._debug("on track"),this.emit("track",e.track,n),this._remoteTracks.push({track:e.track,stream:n}),!this._remoteStreams.some(s=>s.id===n.id)&&(this._remoteStreams.push(n),ut(()=>{this._debug("on stream"),this.emit("stream",n)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],no.apply(null,e)}}Te.WEBRTC_SUPPORT=!!yr();Te.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Te.channelConfig={};var co=Te;const uo=br(co);typeof window>"u"&&(window.global=window);typeof process>"u"&&(window.process=window.process||{},window.process.browser=!0,window.process.env=window.process.env||{});typeof Buffer>"u"&&(window.Buffer=window.Buffer||{from:i=>new Uint8Array(i),alloc:i=>new Uint8Array(i),allocUnsafe:i=>new Uint8Array(i),isBuffer:()=>!1});class fo{constructor(){this.peers={},this.connectedPlayers=new Set,this.localStream=null,this.onRemoteStream=null,this.onRemoteStreamRemoved=null,this.myPlayerId=null,this.roomId=null,this.initialized=!1,this.animationFrames=[],this.canvasStreams={}}createPeer(e,n,s=null){if(console.log(`Создание WebRTC соединения с ${e} (инициатор: ${n})`),this.peers[e]){console.log(`Соединение с ${e} уже существует`);return}const c={initiator:n,trickle:!1,stream:this.localStream,config:{iceServers:[{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun5.l.google.com:19302"},{urls:"stun:stun6.l.google.com:19302"},{urls:"stun:stun7.l.google.com:19302"},{urls:"stun:stun8.l.google.com:19302"},{urls:"stun:stun9.l.google.com:19302"},{urls:"stun:stun10.l.google.com:19302"},{urls:"stun:stun11.l.google.com:19302"},{urls:"stun:stun12.l.google.com:19302"},{urls:"stun:stun13.l.google.com:19302"},{urls:"stun:stun14.l.google.com:19302"},{urls:"stun:stun15.l.google.com:19302"},{urls:"stun:stun16.l.google.com:19302"},{urls:"stun:stun17.l.google.com:19302"},{urls:"stun:stun18.l.google.com:19302"},{urls:"stun:stun19.l.google.com:19302"},{urls:"stun:stun20.l.google.com:19302"}],iceTransportPolicy:"all",iceCandidatePoolSize:10}};try{const h=new uo(c);return h.on("error",d=>{console.error(`Ошибка в соединении с ${e}:`,d),this.handlePeerError(e,d)}),h.on("connect",()=>{if(console.log(`Соединение установлено с ${e}`),this.connectedPlayers.add(e),this.localStream){const d=this.localStream.getVideoTracks()[0];d&&console.log(`Состояние видеотрека для ${e}:`,{enabled:d.enabled,readyState:d.readyState,muted:d.muted})}}),h.on("close",()=>{console.log(`Соединение закрыто с ${e}`),this.handlePeerClose(e)}),h.on("stream",d=>{if(console.log(`Получен поток от ${e}`),this.onRemoteStream){d.playerId=e;const f=d.getVideoTracks()[0];f&&console.log(`Состояние полученного видеотрека от ${e}:`,{enabled:f.enabled,readyState:f.readyState,muted:f.muted}),this.onRemoteStream(e,d)}}),h.on("signal",d=>{console.log(`Отправка сигнала к ${e}`),Y.emit("signal",{to:e,signal:d})}),!n&&s&&h.signal(s),this.peers[e]=h,h}catch(h){console.error(`Ошибка при создании пира для ${e}:`,h),this.handlePeerError(e,h)}}handlePeerError(e,n){this.peers[e]&&(this.peers[e].destroy(),delete this.peers[e]),this.connectedPlayers.delete(e),this.onRemoteStreamRemoved&&this.onRemoteStreamRemoved(e)}handlePeerClose(e){delete this.peers[e],this.connectedPlayers.delete(e),this.onRemoteStreamRemoved&&this.onRemoteStreamRemoved(e)}async createCanvasStream(){const e=document.createElement("canvas");e.width=640,e.height=480;const n=e.getContext("2d");let s=0;const c="Нет камеры",h=()=>{n.fillStyle="#1a1625",n.fillRect(0,0,e.width,e.height);const f=4;n.strokeStyle=`hsl(${s}, 70%, 60%)`,n.lineWidth=f,n.strokeRect(f/2,f/2,e.width-f,e.height-f),s=(s+1)%360,n.font="48px Arial",n.fillStyle="#ffffff",n.textAlign="center",n.textBaseline="middle",n.fillText(c,e.width/2,e.height/2),n.font="36px Arial",n.fillText("🎥",e.width/2,e.height/2-60);const R=requestAnimationFrame(h);this.animationFrames.push(R)};h();const d=e.captureStream(30);return d.isCanvasStream=!0,d}setupSocketListeners(e){Y.off("signal"),Y.off("player-joined"),Y.off("player-left"),Y.off("all-players"),Y.emit("join-room",{roomId:e}),Y.on("all-players",n=>{console.log("Получен список игроков в комнате:",n),n.forEach(s=>{s!==this.myPlayerId&&!this.connectedPlayers.has(s)&&(console.log(`Создаем соединение с игроком ${s}`),this.createPeer(s,!0))})}),Y.on("player-joined",n=>{console.log("Новый игрок присоединился:",n),n!==this.myPlayerId&&!this.connectedPlayers.has(n)&&(console.log(`Создаем соединение с новым игроком ${n}`),this.createPeer(n,!1))}),Y.on("player-left",n=>{console.log("Игрок вышел:",n),this.connectedPlayers.delete(n),this.peers[n]&&(this.peers[n].destroy(),delete this.peers[n]),this.onRemoteStreamRemoved&&this.onRemoteStreamRemoved(n)}),Y.on("signal",({from:n,signal:s})=>{if(console.log("Получен сигнал от:",n),this.peers[n])if(this.peers[n].connected)try{console.log(`Обработка сигнала для существующего соединения с ${n}`),this.peers[n].signal(s)}catch(c){console.error("Ошибка при обработке сигнала:",c),this.handlePeerError(n,c),this.createPeer(n,!1,s)}else console.warn("Соединение с",n,"не установлено или закрыто. Создаём новое соединение."),this.createPeer(n,!1,s);else console.warn("Соединение с",n,"не найдено. Создаём новое соединение."),this.createPeer(n,!1,s)})}toggleVideo(e){if(this.localStream){const n=this.localStream.getVideoTracks();if(n.length>0)return n.forEach(s=>{s.enabled=e}),!0}return!1}toggleAudio(e){if(this.localStream){const n=this.localStream.getAudioTracks();if(n.length>0)return n.forEach(s=>{s.enabled=e}),!0}return!1}isVideoEnabled(){return this.localStream&&this.localStream.getVideoTracks().length>0}isAudioEnabled(){return this.localStream&&this.localStream.getAudioTracks().length>0}stop(){this.localStream&&(this.localStream.getTracks().forEach(n=>n.stop()),this.localStream=null),Object.values(this.peers).forEach(n=>{n&&typeof n.destroy=="function"&&n.destroy()}),this.peers={},Y.off("signal"),Y.off("player-joined"),Y.off("player-left"),Y.off("all-players"),this.animationFrames.forEach(n=>{cancelAnimationFrame(n)}),this.animationFrames=[],document.querySelectorAll('canvas[id^="canvas-"]').forEach(n=>{n.remove()}),this.canvasStreams={},this.initialized=!1,this.connectedPlayers.clear(),this.roomId=null}getStreamInfo(e){return e?{isCanvas:e.isCanvasStream||!1,canvasId:e.canvasId||null,videoTracks:e.getVideoTracks().length,audioTracks:e.getAudioTracks().length}:null}async init(e){console.log("Инициализация Video API с WebRTC для комнаты:",e),this.roomId=e,this.localStream&&(this.localStream.getTracks().forEach(c=>c.stop()),this.localStream=null);let n=0;const s=3;for(;n<s;)try{console.log(`Попытка ${n+1}/${s} получить видеопоток с камеры...`);const c=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:30}},audio:!1});console.log("Медиапоток получен успешно: видео треков:",c.getVideoTracks().length,", аудио треков:",c.getAudioTracks().length);const h=c.getVideoTracks()[0];console.log("Параметры видеотрека:",h.getSettings()),this.localStream=c;break}catch(c){if(console.error(`Попытка ${n+1}/${s} не удалась:`,c),c.name==="NotReadableError"&&n<s-1){console.log("Устройство занято, ждем 2 секунды перед следующей попыткой..."),await new Promise(h=>setTimeout(h,2e3)),n++;continue}console.error("Не удалось получить видеопоток с камеры:",c),console.log("Создаем поток из канваса вместо камеры"),this.localStream=await this.createCanvasStream();break}return this.initialized=!0,this.localStream}}const xe=new fo,Vt=({stream:i,playerId:e,playerName:n,character:s,isCurrentPlayer:c,isVideoEnabled:h=!0,isAudioEnabled:d=!0,muted:f})=>{const R=ie.useRef(null),[E,b]=ie.useState(!1),[y,F]=ie.useState(null),[k,O]=ie.useState("connecting");ie.useEffect(()=>{if(console.log("PlayerVideo: Обновление потока для",e,i?`Видеотреков: ${i.getVideoTracks().length}, Аудиотреков: ${i.getAudioTracks().length}`:"нет потока"),!i||!R.current){console.log("Нет потока для игрока",e,"или ссылки на видеоэлемент");return}const p=R.current,x=i.getVideoTracks()[0];x&&console.log("Видеотрек для",e,":",{enabled:x.enabled,active:x.active,type:x.kind,readyState:x.readyState,muted:x.muted}),p.srcObject&&(console.log("Очищаем предыдущий источник видео для",e),p.srcObject=null),p.srcObject=i;const v=()=>{console.log("Видео успешно запущено для",e)},B=P=>{console.error("Ошибка воспроизведения видео:",P),setTimeout(()=>{p.paused&&(console.log("Пробуем перезапустить воспроизведение для",e),p.play().catch(J=>{console.error("Ошибка при перезапуске воспроизведения:",J)}))},1e3)},I=()=>{console.log("Метаданные видео загружены для",e),p.play().catch(P=>{console.error("Ошибка при запуске воспроизведения:",P)})};return p.addEventListener("play",v),p.addEventListener("error",B),p.addEventListener("loadedmetadata",I),()=>{console.log("Очистка компонента PlayerVideo для",e),p.removeEventListener("play",v),p.removeEventListener("error",B),p.removeEventListener("loadedmetadata",I),p.srcObject&&(p.srcObject.getTracks().forEach(P=>P.stop()),p.srcObject=null)}},[i,e]);const L=p=>{console.error(`Ошибка воспроизведения видео для ${e}:`,p),F(p.message||"Ошибка воспроизведения видео"),b(!1),O("error")},N=()=>{console.log(`Видео успешно запущено для ${e}`),O("active"),b(!0)};return i&&(E||i.getVideoTracks().length>0||i.isCanvasStream),C.jsxs("div",{className:U.playerVideoContainer,children:[i?C.jsxs("div",{className:U.videoWrapper,children:[C.jsx("video",{ref:R,className:U.playerVideo,autoPlay:!0,playsInline:!0,muted:f,onError:L,onPlay:N}),C.jsx("div",{className:`${U.videoStatus} ${U[`videoStatus${k.charAt(0).toUpperCase()+k.slice(1)}`]}`,children:C.jsxs("span",{className:U.streamIcon,children:[k==="connecting"&&"⌛",k==="active"&&"✓",k==="error"&&"✗"]})})]}):C.jsx("div",{className:U.placeholderVideo,children:C.jsxs("div",{className:U.placeholderContent,children:[C.jsx("span",{role:"img","aria-label":"user",children:"👤"}),C.jsx("div",{className:U.noVideoText,children:y?"Ошибка видео":"Подключение..."}),C.jsx("div",{className:U.spinnerContainer,children:C.jsx("div",{className:U.spinner})})]})}),!h&&i&&C.jsx("div",{className:U.videoDisabled,children:C.jsx("span",{className:U.noVideoIcon,children:"🎥"})}),C.jsxs("div",{className:U.playerInfo,children:[C.jsxs("div",{className:U.playerName,children:[n||`Игрок ${(e==null?void 0:e.substring(0,4))||"неизвестный"}`," ",c&&" (Вы)"]}),s&&C.jsxs("div",{className:U.playerCharacter,children:["Персонаж: ",c?"???":s]}),!d&&C.jsx("div",{className:U.mediaControls,children:C.jsx("span",{className:U.mutedIcon,children:"🔇"})})]})]})},ho=()=>{var be;const i=vr(),e=Ht(),[n,s]=ie.useState(""),[c,h]=ie.useState("connecting"),[d,f]=ie.useState(""),[R,E]=ie.useState(null),[b,y]=ie.useState(""),[F,k]=ie.useState(!0),[O,L]=ie.useState(!0),N=ie.useRef(null),[p,x]=ie.useState({}),[v,B]=ie.useState({roomCode:"",players:[],isHost:!1,playerName:"",gameStarted:!1,playerId:"",characterAssignments:{},characters:{}}),I=["Я человек?","Я вымышленный персонаж?","Я живу в наше время?","Я известная личность?","Я спортсмен?","Я актер/актриса?","Я музыкант?","Я политик?","Я старше 50 лет?","Я мужчина?","Я женщина?"],P=M=>{if(!M)return"Неизвестная ошибка при доступе к камере";switch(M.name){case"NotAllowedError":return"Доступ к камере запрещен. Пожалуйста, разрешите доступ к камере в настройках браузера и перезагрузите страницу.";case"NotFoundError":return"Камера не найдена. Проверьте, что камера подключена и работает.";case"NotReadableError":return"Камера уже используется другим приложением. Закройте другие приложения, использующие камеру, и перезагрузите страницу.";case"OverconstrainedError":return"Запрошенное разрешение камеры недоступно. Попробуйте с меньшими параметрами.";case"AbortError":return"Операция прервана. Попробуйте еще раз.";case"SecurityError":return"Использование камеры заблокировано настройками безопасности браузера.";case"TypeError":return"Неподдерживаемый тип параметров для доступа к камере.";default:return`Ошибка при доступе к камере: ${M.message||M.name}`}};ie.useEffect(()=>{const M=new URLSearchParams(i.search),oe=M.get("name"),ue=M.get("room"),Z=M.get("host")==="true";if(!oe||!ue){e("/");return}B(W=>({...W,playerName:oe,roomCode:ue,isHost:Z}))},[i.search,e]),ie.useEffect(()=>{if(!v.roomCode||!v.playerName)return;console.log("Инициализация соединения с комнатой:",v.roomCode),h("connecting"),Y.init();const M=W=>{console.log("Получено обновление комнаты:",W);const ee=W.players.filter((le,Ee,te)=>Ee===te.findIndex(ce=>ce.id===le.id));B(le=>({...le,players:ee,gameStarted:W.gameStarted||le.gameStarted,characterAssignments:W.characterAssignments||le.characterAssignments,characters:W.characters||le.characters}))},oe=W=>{console.log("Игра началась:",W),B(ee=>({...ee,gameStarted:!0,characterAssignments:W.characterAssignments}))},ue=W=>{console.log("Получен персонаж:",W),B(ee=>({...ee,characters:{...ee.characters,[Y.getSocketId()]:W.character}}))},Z=()=>{console.log("Соединение установлено"),h("connected"),s(""),v.isHost?Y.createRoom(v.playerName):Y.joinRoom(v.roomCode,v.playerName)};return Y.on("room-updated",M),Y.on("game-started",oe),Y.on("character-assigned",ue),Y.on("connect",Z),Y.isConnected()&&Z(),()=>{Y.off("room-updated",M),Y.off("game-started",oe),Y.off("character-assigned",ue),Y.off("connect",Z)}},[v.roomCode,v.playerName,v.isHost]),ie.useEffect(()=>{if(!v.roomCode||!v.playerName||c!=="connected")return;console.log("Инициализация видео для комнаты:",v.roomCode);const M=(Z,W)=>{console.log("Получен удаленный поток от:",Z,W?`Видеотреков: ${W.getVideoTracks().length}, Аудиотреков: ${W.getAudioTracks().length}`:"Нет потока"),W&&(W.getTracks().length>0||W.isCanvasStream?x(ee=>({...ee,[Z]:W})):console.warn(`Поток от ${Z} не содержит треков и не является canvas-потоком, игнорируем`))},oe=Z=>{console.log("Удален удаленный поток от:",Z),x(W=>{const ee={...W};return delete ee[Z],ee})},ue=async(Z=1)=>{try{console.log(`Попытка инициализации видео ${Z}/3`);const W=await xe.init(v.roomCode,M,oe);console.log("Локальный поток инициализирован:",W?`Видеотреков: ${W.getVideoTracks().length}, Аудиотреков: ${W.getAudioTracks().length}`:"Нет потока"),N.current&&(N.current.srcObject=W);const ee=Y.getSocketId();return ee&&B(le=>({...le,playerId:ee})),k(xe.isVideoEnabled()),L(xe.isAudioEnabled()),!0}catch(W){if(console.error(`Ошибка при инициализации видео (попытка ${Z}/3):`,W),Z<3)return console.log("Повторная попытка через 1 секунду..."),await new Promise(le=>setTimeout(le,1e3)),ue(Z+1);s(P(W)),k(!1),L(!1);const ee=Y.getSocketId();return ee&&B(le=>({...le,playerId:ee})),!1}};return ue(),()=>{xe.stop()}},[v.roomCode,v.playerName,c]);const J=()=>{v.isHost&&Y.startGame(v.roomCode)},$=M=>{if(!b.trim()){s("Введите имя персонажа");return}Y.emit("assign-character",{roomCode:v.roomCode,targetPlayerId:M,character:b}),y(""),E(null)},q=()=>{const M=!F;xe.toggleVideo(M),k(M)},fe=()=>{const M=!O;xe.toggleAudio(M),L(M)},me=()=>{xe.stop(),e("/")};return C.jsxs("div",{className:U.gamePage,children:[C.jsxs("div",{className:U.gameHeader,children:[C.jsxs("div",{className:U.roomInfo,children:[C.jsxs("h2",{children:["Комната: ",v.roomCode]}),c==="connecting"&&C.jsx("div",{className:U.connecting,children:"Подключение..."}),c==="error"&&C.jsx("div",{className:U.error,children:n||"Ошибка подключения"})]}),C.jsxs("div",{className:U.gameControls,children:[v.isHost&&!v.gameStarted&&C.jsx("button",{className:U.startButton,onClick:J,children:"Начать игру"}),C.jsx("button",{className:U.leaveButton,onClick:me,children:"Выйти"})]})]}),C.jsxs("div",{className:U.gameContent,children:[C.jsxs("div",{className:U.videoGrid,children:[C.jsxs("div",{className:`${U.videoBox} ${U.localVideo}`,children:[C.jsx(Vt,{stream:((be=N.current)==null?void 0:be.srcObject)||null,playerId:v.playerId,playerName:v.playerName,character:v.characters[v.playerId],isCurrentPlayer:!0,isVideoEnabled:F,isAudioEnabled:O}),C.jsxs("div",{className:U.videoControls,children:[C.jsx("button",{className:F?U.videoOn:U.videoOff,onClick:q,title:F?"Выключить камеру":"Включить камеру",children:F?"🎥":"🚫"}),C.jsx("button",{className:O?U.audioOn:U.audioOff,onClick:fe,title:O?"Выключить микрофон":"Включить микрофон",children:O?"🔊":"🔇"})]})]}),v.players.filter(M=>M.id!==v.playerId).filter((M,oe,ue)=>oe===ue.findIndex(Z=>Z.id===M.id)).map(M=>C.jsxs("div",{className:U.videoBox,children:[C.jsx(Vt,{stream:p[M.id],playerId:M.id,playerName:M.name,character:v.characters[M.id],isCurrentPlayer:!1,isVideoEnabled:!0,isAudioEnabled:!0}),v.gameStarted&&v.characterAssignments[v.playerId]===M.id&&C.jsx("div",{className:U.assignCharacter,children:R===M.id?C.jsxs("div",{className:U.characterForm,children:[C.jsx("input",{type:"text",value:b,onChange:oe=>y(oe.target.value),placeholder:"Введите персонажа"}),C.jsxs("div",{className:U.formButtons,children:[C.jsx("button",{onClick:()=>$(M.id),children:"Назначить"}),C.jsx("button",{onClick:()=>E(null),children:"Отмена"})]})]}):C.jsx("button",{onClick:()=>E(M.id),className:U.assignButton,children:"Назначить персонажа"})})]},`player-${M.id}`))]}),C.jsx("div",{className:U.gameSidebar,children:v.gameStarted?C.jsxs(C.Fragment,{children:[C.jsxs("div",{className:U.gameInfo,children:[C.jsx("h3",{children:"Игра началась!"}),v.characters[v.playerId]?C.jsxs("p",{children:["Ваш персонаж: ",C.jsx("strong",{children:"???"})]}):C.jsx("p",{children:"Ожидайте, пока вам загадают персонажа"})]}),C.jsxs("div",{className:U.hintQuestions,children:[C.jsx("h3",{children:"Подсказки для вопросов:"}),C.jsx("ul",{children:I.map((M,oe)=>C.jsx("li",{children:M},oe))})]}),C.jsxs("div",{className:U.notes,children:[C.jsx("h3",{children:"Ваши заметки:"}),C.jsx("textarea",{value:d,onChange:M=>f(M.target.value),placeholder:"Записывайте здесь свои догадки...",className:U.notesArea})]})]}):C.jsxs("div",{className:U.waitingRoom,children:[C.jsx("h3",{children:"Ожидание игроков"}),C.jsxs("p",{children:["В комнате ",v.players.length," игроков"]}),C.jsx("ul",{className:U.playersList,children:v.players.map((M,oe)=>C.jsxs("li",{children:[M.name," ",M.isHost&&" (Хост)",M.id===v.playerId&&" (Вы)"]},`player-list-${M.id}-${oe}`))}),v.isHost&&v.players.length>=2?C.jsx("p",{children:"Можно начинать игру!"}):v.isHost?C.jsx("p",{children:"Нужно минимум 2 игрока для начала игры"}):C.jsx("p",{children:"Ожидайте, когда хост начнет игру"})]})})]}),n&&C.jsx("div",{className:U.errorModal,children:C.jsxs("div",{className:U.errorContent,children:[C.jsx("h3",{children:"Произошла ошибка"}),C.jsx("p",{children:n}),C.jsx("div",{className:U.errorActions,children:C.jsx("button",{onClick:()=>s(""),className:U.continueButton,children:"Продолжить без камеры"})})]})}),C.jsx("video",{ref:N,autoPlay:!0,playsInline:!0,muted:!0,style:{display:"none"}})]})},po={main:{path:"/",element:C.jsx(Lr,{})},game:{path:"/game",element:C.jsx(ho,{})}},go=()=>C.jsx(ie.Suspense,{fallback:C.jsx("div",{children:"Loading..."}),children:C.jsx(Rr,{children:Object.values(po).map(({path:i,element:e})=>C.jsx(Cr,{path:i,element:e},i))})}),_o="_header_ksqj1_1",yo="_container_ksqj1_15",mo="_logo_ksqj1_29",wo="_icon_ksqj1_45",bo="_text_ksqj1_53",Eo="_actions_ksqj1_61",vo="_connectButton_ksqj1_71",Ro="_createButton_ksqj1_99",Re={header:_o,container:yo,logo:mo,icon:wo,text:bo,actions:Eo,connectButton:vo,createButton:Ro},Co=()=>C.jsx("header",{className:Re.header,children:C.jsxs("div",{className:Re.container,children:[C.jsxs(qe,{to:"/",className:Re.logo,children:[C.jsx("span",{className:Re.icon,children:"📋"}),C.jsx("span",{className:Re.text,children:"Who Am I?"})]}),C.jsxs("div",{className:Re.actions,children:[C.jsx("button",{className:Re.connectButton,children:"Connect"}),C.jsx(qe,{to:"/",className:Re.createButton,children:"Create"})]})]})}),So="_footer_4qbq9_1",xo="_container_4qbq9_15",To="_copyright_4qbq9_35",Ao="_links_4qbq9_47",No="_social_4qbq9_79",Ue={footer:So,container:xo,copyright:To,links:Ao,social:No},Bo=()=>C.jsx("footer",{className:Ue.footer,children:C.jsxs("div",{className:Ue.container,children:[C.jsx("div",{className:Ue.copyright,children:C.jsx("p",{children:"© 2023 Who Am I. All rights reserved."})}),C.jsxs("div",{className:Ue.links,children:[C.jsx(qe,{to:"/",children:"Home"}),C.jsx(qe,{to:"/about",children:"About"}),C.jsx(qe,{to:"/privacy",children:"Privacy"})]}),C.jsxs("div",{className:Ue.social,children:[C.jsx("a",{href:"https://github.com",target:"_blank",rel:"noopener noreferrer","aria-label":"GitHub",children:C.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:C.jsx("path",{d:"M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"})})}),C.jsx("a",{href:"https://twitter.com",target:"_blank",rel:"noopener noreferrer","aria-label":"Twitter",children:C.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:C.jsx("path",{d:"M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"})})})]})]})}),Io="_layout_kkmdn_1",Fo="_main_kkmdn_19",zt={layout:Io,main:Fo},Oo=({children:i})=>C.jsxs("div",{className:zt.layout,children:[C.jsx(Co,{}),C.jsx("main",{className:zt.main,children:i}),C.jsx(Bo,{})]});function Lo(){return C.jsx(Sr,{basename:"/GithubPagesCoonfigTest",children:C.jsx(Oo,{children:C.jsx(go,{})})})}ht.createRoot(document.getElementById("root")).render(C.jsx(Er.StrictMode,{children:C.jsx(Lo,{})}));
//# sourceMappingURL=index-CZXtT44U.js.map
